function TL_Error(a,t){this.name="TL.Error",this.message=a||"error",this.message_key=this.message,this.detail=t||"";var e=new Error;e.hasOwnProperty("stack")&&(this.stack=e.stack)}!function(e){e.TL={VERSION:"0.1",_originalL:e.TL}}(this),TL.debug=!1,TL.Bind=function(a,t){return function(){return a.apply(t,arguments)}},trace=function(e){TL.debug&&(window.console?console.log(e):"undefined"!=typeof jsTrace&&jsTrace.send(e))},TL_Error.prototype=Object.create(Error.prototype),TL_Error.prototype.constructor=TL_Error,TL.Error=TL_Error,TL.Util={mergeData(a,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e]);return a},extend(o){for(var t,s=Array.prototype.slice.call(arguments,1),i=0,r=s.length;i<r;i++)t=s[i]||{},TL.Util.mergeData(o,t);return o},isEven(e){return e==parseFloat(e)?!(e%2):void 0},isTrue(e){return null!=e&&(1==e||"true"==(e+"").toLowerCase()||1==+e)},findArrayNumberByUniqueID(o,t,e,i){for(var r=i||0,l=0;l<t.length;l++)t[l].data[e]==o&&(r=l);return r},convertUnixTime(r){var t,l,d,c=[],a={ymd:"",time:"",time_array:[],date_array:[],full_array:[]};a.ymd=r.split(" ")[0],a.time=r.split(" ")[1],a.date_array=a.ymd.split("-"),a.time_array=a.time.split(":"),a.full_array=a.date_array.concat(a.time_array);for(var s=0;s<a.full_array.length;s++)c.push(parseInt(a.full_array[s]));return l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=(t=new Date(c[0],c[1],c[2],c[3],c[4],c[5])).getFullYear(),l[t.getMonth()]+", "+t.getDate()+" "+d},setData(a,t){a.data=TL.Util.extend({},a.data,t),""===a.data.unique_id&&(a.data.unique_id=TL.Util.unique_ID(6))},stamp(){var a=0;return function(e){return e._tl_id=e._tl_id||++a,e._tl_id}},isArray(){if(Array.isArray)return Array.isArray;var a=Object.prototype.toString,e=a.call([]);return function(i){return a.call(i)===e}},getRandomNumber(e){return Math.floor(Math.random()*e)},unique_ID(a,t){function e(a){for(var t="",o=0;o<a;o++)t+="abcdefghijklmnopqurstuvwxyz".substr(Math.floor(32*Math.random()),1);return t}return t?t+"-"+e(a):"tl-"+e(a)},ensureUniqueKey(o,t){if(!((t=t||TL.Util.unique_ID(6))in o))return t;var s=t.match(/^(.+)(-\d+)?$/)[1],i=[];for(key in o)key.match(/^(.+?)(-\d+)?$/)[1]==s&&i.push(key);t=s+"-"+(i.length+1);for(var r=i.length;-1!=i.indexOf(t);r++)t=s+"-"+r;return t},htmlify(e){return e.match(/<p>[\s\S]*?<\/p>/)?e:"<p>"+e+"</p>"},unhtmlify(e){return(e=e.replace(/(<[^>]*>)+/g,"")).replace("\"","'")},linkify(e){function o(a,t,o){return o=o||"",t&&30<t.length&&(t=t.substring(0,30)+"\u2026"),o+"<a class='tl-makelink' href='"+a+"' onclick='void(0)'>"+t+"</a>"}return e.replace(/\b(?:https?|ftp):\/\/([a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|])/gim,function(s,t,e,i){if(0<e){var r=i[e-1];if("\""==r||"'"==r||"="==r)return s}return o(s,t)}).replace(/(^|[^\/>])(www\.[\S]+(\b|$))/gim,function(a,t,e){return o("http://"+e,e,t)}).replace(/([a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+)/gim,function(a,t){return o("mailto:"+t,t)})},unlinkify(e){return e?e=(e=e.replace(/<a\b[^>]*>/i,"")).replace(/<\/a>/i,""):e},getParamString(a){var t=[];for(var e in a)a.hasOwnProperty(e)&&t.push(e+"="+a[e]);return"?"+t.join("&")},formatNum(a,t){var e=Math.pow(10,t||5);return Math.round(a*e)/e},falseFn(){return!1},requestAnimFrame(){function o(e){window.setTimeout(e,1e3/60)}var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||o;return function(s,r,e,i){s=r?TL.Util.bind(s,r):s,e&&a===o?s():a(s,i)}},bind(a,t){return function(){return a.apply(t,arguments)}},template(e,a){return e.replace(/\{ *([\w_]+) *\}/g,function(o,t){var e=a[t];if(!a.hasOwnProperty(t))throw new TL.Error("template_value_err",o);return e})},hexToRgb(a){TL.Util.css_named_colors[a.toLowerCase()]&&(a=TL.Util.css_named_colors[a.toLowerCase()]),a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,t,e,i){return t+t+e+e+i+i});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgbToHex(o){var t,s,r;if("object"==typeof o)t=o.r,s=o.g,r=o.b;else if("function"==typeof o.match){var l=o.match(/^rgb\((\d+),(\d+),(\d+)\)$/);l&&(t=l[1],s=l[2],r=l[3])}if(isNaN(t)||isNaN(r)||isNaN(s))throw new TL.Error("invalid_rgb_err");return"#"+TL.Util.intToHexString(t)+TL.Util.intToHexString(s)+TL.Util.intToHexString(r)},colorObjToHex(a){var t=[a.r,a.g,a.b];return TL.Util.rgbToHex("rgb("+t.join(",")+")")},css_named_colors:{},ratio:{square(a){var t={w:0,h:0};return a.w>a.h&&0<a.h?(t.h=a.h,t.w=a.h):(t.w=a.w,t.h=a.w),t},r16_9(e){return null!==e.w&&""!==e.w?Math.round(9*(e.w/16)):null!==e.h&&""!==e.h?Math.round(16*(e.h/9)):0},r4_3(e){return null!==e.w&&""!==e.w?Math.round(3*(e.w/4)):null!==e.h&&""!==e.h?Math.round(4*(e.h/3)):void 0}},getObjectAttributeByIndex(a,t){if(void 0===a)return"";var e=0;for(var o in a){if(t===e)return a[o];e++}return""},getUrlVars(o){var t,r,l,d=[];(t=o.toString()).match("&#038;")?t=t.replace("&#038;","&"):t.match("&#38;")?t=t.replace("&#38;","&"):t.match("&amp;")&&(t=t.replace("&amp;","&")),l=t.slice(t.indexOf("?")+1).split("&");for(var a=0;a<l.length;a++)r=l[a].split("="),d.push(r[0]),d[r[0]]=r[1];return d},trim(e){return e&&"function"==typeof e.replace?e.replace(/^\s+|\s+$/g,""):""},slugify(a){a=(a=TL.Util.trim(a)).toLowerCase();for(var o="\xC3\xA3\xC3 \xC3\xA1\xC3\xA4\xC3\xA2\xE1\xBA\xBD\xC3\xA8\xC3\xA9\xC3\xAB\xC3\xAA\xC3\xAC\xC3\xAD\xC3\xAF\xC3\xAE\xC3\xB5\xC3\xB2\xC3\xB3\xC3\xB6\xC3\xB4\xC3\xB9\xC3\xBA\xC3\xBC\xC3\xBB\xC3\xB1\xC3\xA7\xC2\xB7/_,:;",e=0,s=o.length;e<s;e++)a=a.replace(new RegExp(o.charAt(e),"g"),"aaaaaeeeeeiiiiooooouuuunc------".charAt(e));return(a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")).replace(/^([0-9])/,"_$1")},maxDepth(r){for(var t=[],l=0,d=0;d<r.length;d++){if(t.push(r[d]),1<t.length){for(var c=t[t.length-1],a=-1,_=0;_<t.length-1;_++)t[_][1]<c[0]&&(a=_);0<=a&&(t=t.slice(a+1))}t.length>l&&(l=t.length)}return l},pad(a,i){for(a=a+"",i=i||2;a.length<i;)a="0"+a;return a},intToHexString(e){return TL.Util.pad(parseInt(e,10).toString(16))},findNextGreater(a,t,e){for(var i=0;i<a.length;i++)if(t<a[i])return a[i];return e||t},findNextLesser(a,t,e){for(var i=a.length-1;0<=i;i--)if(t>a[i])return a[i];return e||t},isEmptyObject(o){var t=[];if(Object.keys)t=Object.keys(o);else for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.push(s);for(var i,r=0;r<t.length;r++){if(i=t[r],null!=o[i]&&"string"!=typeof o[i])return!1;if(0!=TL.Util.trim(o[i]).length)return!1}return!0},parseYouTubeTime(a){if("string"==typeof a){if(parts=a.match(/^\s*(\d+h)?(\d+m)?(\d+s)?\s*/i),parts){var t=parseInt(parts[1])||0,e=parseInt(parts[2])||0;return(parseInt(parts[3])||0)+60*e+60*(60*t)}}else if("number"==typeof a)return a;return 0},transformImageURL(e){return e.replace(/(.*)www.dropbox.com\/(.*)/,"$1dl.dropboxusercontent.com/$2")},base58(){"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ".length;return{encode(a){if("number"!=typeof a||a!==parseInt(a))throw"\"encode\" only accepts integers.";for(var o,s="";a;)o=a%58,a=Math.floor(a/58),s="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"[o].toString()+s;return s},decode(a){if("string"!=typeof a)throw"\"decode\" only accepts strings.";for(var o,s=0;a;){if(o="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(a[0]),0>o)throw"\"decode\" can't find \""+a[0]+"\" in the alphabet: \"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ\"";var r=a.length-1;s+=o*Math.pow(58,r),a=a.substring(1)}return s}}}},function(uc){function Nc(e){return null==e?e+"":Hc[Ic.call(e)]||"object"}function Oc(e){return"function"==Nc(e)}function Pc(e){return null!=e&&e==e.window}function Qc(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function Rc(e){return"object"==Nc(e)}function Sc(e){return Rc(e)&&!Pc(e)&&Object.getPrototypeOf(e)==Object.prototype}function Tc(e){return"number"==typeof e.length}function Uc(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function Vc(e){return e in sc?sc[e]:sc[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function Wc(a,t){return"number"!=typeof t||tc[Uc(a)]?t:t+"px"}function Xc(e){return"children"in e?oc.call(e.children):jc.map(e.childNodes,function(e){if(1==e.nodeType)return e})}function Yc(a,t){return null==t?jc(a):jc(a).filter(t)}function Zc(a,t,e,i){return Oc(t)?t.call(a,e,i):t}function $c(a,t,e){null==e?a.removeAttribute(t):a.setAttribute(t,e)}function _c(a,t){var e=a.className,i=e&&e.baseVal!==hc;return t===hc?i?e.baseVal:e:void(i?e.baseVal=t:a.className=t)}function ad(a){var t;try{return a?"true"==a||"false"!=a&&("null"==a?null:/^0/.test(a)||isNaN(t=+a)?/^[\[\{]/.test(a)?jc.parseJSON(a):a:t):a}catch(t){return a}}var Um,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,vc=(nc=[],oc=nc.slice,pc=nc.filter,qc=window.document,rc={},sc={},tc={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},wc=/^\s*<(\w+|!)[^>]*>/,xc=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,yc=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,zc=/^(?:body|html)$/i,Ac=/([A-Z])/g,Bc=["val","css","html","text","data","width","height","offset"],Cc=qc.createElement("table"),Dc=qc.createElement("tr"),Ec={tr:qc.createElement("tbody"),tbody:Cc,thead:Cc,tfoot:Cc,td:Dc,th:Dc,"*":qc.createElement("div")},Fc=/complete|loaded|interactive/,Gc=/^[\w-]*$/,Hc={},Ic=Hc.toString,Jc={},Kc=qc.createElement("div"),Lc={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Mc=Array.isArray||function(e){return e instanceof Array},Jc.matches=function(o,t){if(!t||!o||1!==o.nodeType)return!1;var e=o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.matchesSelector;if(e)return e.call(o,t);var i,r=o.parentNode,l=!r;return l&&(r=Kc).appendChild(o),i=~Jc.qsa(r,t).indexOf(o),l&&Kc.removeChild(o),i},lc=function(e){return e.replace(/-+(.)?/g,function(a,t){return t?t.toUpperCase():""})},mc=function(a){return pc.call(a,function(i,t){return a.indexOf(i)==t})},Jc.fragment=function(o,r,l){var i,d,c;return xc.test(o)&&(i=jc(qc.createElement(RegExp.$1))),i||(o.replace&&(o=o.replace(yc,"<$1></$2>")),r===hc&&(r=wc.test(o)&&RegExp.$1),r in Ec||(r="*"),(c=Ec[r]).innerHTML=""+o,i=jc.each(oc.call(c.childNodes),function(){c.removeChild(this)})),Sc(l)&&(d=jc(i),jc.each(l,function(a,t){-1<Bc.indexOf(a)?d[a](t):d.attr(a,t)})),i},Jc.Z=function(a,i){return(a=a||[]).__proto__=jc.fn,a.selector=i||"",a},Jc.isZ=function(e){return e instanceof Jc.Z},Jc.init=function(a,o){var e;if(!a)return Jc.Z();if("string"!=typeof a){if(Oc(a))return jc(qc).ready(a);if(Jc.isZ(a))return a;if(Mc(a))e=pc.call(a,function(e){return null!=e});else if(Rc(a))e=[a],a=null;else if(wc.test(a))e=Jc.fragment(a.trim(),RegExp.$1,o),a=null;else{if(o!==hc)return jc(o).find(a);e=Jc.qsa(qc,a)}}else if("<"==(a=a.trim())[0]&&wc.test(a))e=Jc.fragment(a,RegExp.$1,o),a=null;else{if(o!==hc)return jc(o).find(a);e=Jc.qsa(qc,a)}return Jc.Z(e,a)},(jc=function(a,t){return Jc.init(a,t)}).extend=function(a){var o,s=oc.call(arguments,1);return"boolean"==typeof a&&(o=a,a=s.shift()),s.forEach(function(e){!function a(t,e,i){for(ic in e)i&&(Sc(e[ic])||Mc(e[ic]))?(Sc(e[ic])&&!Sc(t[ic])&&(t[ic]={}),Mc(e[ic])&&!Mc(t[ic])&&(t[ic]=[]),a(t[ic],e[ic],i)):e[ic]!==hc&&(t[ic]=e[ic])}(a,e,o)}),a},Jc.qsa=function(r,t){var e,l="#"==t[0],d=!l&&"."==t[0],a=l||d?t.slice(1):t,s=Gc.test(a);return Qc(r)&&s&&l?(e=r.getElementById(a))?[e]:[]:1!==r.nodeType&&9!==r.nodeType?[]:oc.call(s&&!l?d?r.getElementsByClassName(a):r.getElementsByTagName(t):r.querySelectorAll(t))},jc.contains=function(a,t){return a!==t&&a.contains(t)},jc.type=Nc,jc.isFunction=Oc,jc.isWindow=Pc,jc.isArray=Mc,jc.isPlainObject=Sc,jc.isEmptyObject=function(a){for(var t in a)return!1;return!0},jc.inArray=function(a,t,e){return nc.indexOf.call(t,a,e)},jc.camelCase=lc,jc.trim=function(e){return null==e?"":String.prototype.trim.call(e)},jc.uuid=0,jc.support={},jc.expr={},jc.map=function(r,t){var e,l,d,c,_=[];if(Tc(r))for(l=0;l<r.length;l++)null!=(e=t(r[l],l))&&_.push(e);else for(d in r)null!=(e=t(r[d],d))&&_.push(e);return 0<(c=_).length?jc.fn.concat.apply([],c):c},jc.each=function(a,t){var e,o;if(Tc(a)){for(e=0;e<a.length;e++)if(!1===t.call(a[e],e,a[e]))return a;}else for(o in a)if(!1===t.call(a[o],o,a[o]))return a;return a},jc.grep=function(a,t){return pc.call(a,t)},window.JSON&&(jc.parseJSON=JSON.parse),jc.each(["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],function(a,t){Hc["[object "+t+"]"]=t.toLowerCase()}),jc.fn={forEach:nc.forEach,reduce:nc.reduce,push:nc.push,sort:nc.sort,indexOf:nc.indexOf,concat:nc.concat,map(a){return jc(jc.map(this,function(i,t){return a.call(i,t,i)}))},slice(){return jc(oc.apply(this,arguments))},ready(e){return Fc.test(qc.readyState)&&qc.body?e(jc):qc.addEventListener("DOMContentLoaded",function(){e(jc)},!1),this},get(e){return e===hc?oc.call(this):this[0<=e?e:e+this.length]},toArray(){return this.get()},size(){return this.length},remove(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each(a){return nc.every.call(this,function(i,t){return!1!==a.call(i,t,i)}),this},filter(a){return Oc(a)?this.not(this.not(a)):jc(pc.call(this,function(e){return Jc.matches(e,a)}))},add(a,t){return jc(mc(this.concat(jc(a,t))))},is(e){return 0<this.length&&Jc.matches(this[0],e)},not(a){var e=[];if(Oc(a)&&a.call!==hc)this.each(function(i){a.call(this,i)||e.push(this)});else{var i="string"==typeof a?this.filter(a):Tc(a)&&Oc(a.item)?oc.call(a):jc(a);this.forEach(function(a){0>i.indexOf(a)&&e.push(a)})}return jc(e)},has(e){return this.filter(function(){return Rc(e)?jc.contains(this,e):jc(this).find(e).size()})},eq(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first(){var e=this[0];return e&&!Rc(e)?e:jc(e)},last(){var e=this[this.length-1];return e&&!Rc(e)?e:jc(e)},find(e){var t=this;return"object"==typeof e?jc(e).filter(function(){var a=this;return nc.some.call(t,function(e){return jc.contains(e,a)})}):1==this.length?jc(Jc.qsa(this[0],e)):this.map(function(){return Jc.qsa(this,e)})},closest(a,t){var e=this[0],o=!1;for("object"==typeof a&&(o=jc(a));e&&(o?!(0<=o.indexOf(e)):!Jc.matches(e,a));)e=e!==t&&!Qc(e)&&e.parentNode;return jc(e)},parents(a){for(var o=[],e=this;0<e.length;)e=jc.map(e,function(e){if((e=e.parentNode)&&!Qc(e)&&0>o.indexOf(e))return o.push(e),e});return Yc(o,a)},parent(e){return Yc(mc(this.pluck("parentNode")),e)},children(e){return Yc(this.map(function(){return Xc(this)}),e)},contents(){return this.map(function(){return oc.call(this.childNodes)})},siblings(e){return Yc(this.map(function(a,i){return pc.call(Xc(i.parentNode),function(e){return e!==i})}),e)},empty(){return this.each(function(){this.innerHTML=""})},pluck(a){return jc.map(this,function(e){return e[a]})},show(){return this.each(function(){var a,o,s;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(a=this.nodeName,rc[a]||(o=qc.createElement(a),qc.body.appendChild(o),s=getComputedStyle(o,"").getPropertyValue("display"),o.parentNode.removeChild(o),"none"==s&&(s="block"),rc[a]=s),rc[a]))})},replaceWith(e){return this.before(e).remove()},wrap(o){var e=Oc(o);if(this[0]&&!e)var i=jc(o).get(0),s=i.parentNode||1<this.length;return this.each(function(a){jc(this).wrapAll(e?o.call(this,a):s?i.cloneNode(!0):i)})},wrapAll(a){if(this[0]){var i;for(jc(this[0]).before(a=jc(a));(i=a.children()).length;)a=i.first();jc(a).append(this)}return this},wrapInner(o){var a=Oc(o);return this.each(function(s){var t=jc(this),e=t.contents(),i=a?o.call(this,s):o;e.length?e.wrapAll(i):t.append(i)})},unwrap(){return this.parent().each(function(){jc(this).replaceWith(jc(this).children())}),this},clone(){return this.map(function(){return this.cloneNode(!0)})},hide(){return this.css("display","none")},toggle(a){return this.each(function(){var e=jc(this);(a===hc?"none"==e.css("display"):a)?e.show():e.hide()})},prev(e){return jc(this.pluck("previousElementSibling")).filter(e||"*")},next(e){return jc(this.pluck("nextElementSibling")).filter(e||"*")},html(a){return 0===arguments.length?0<this.length?this[0].innerHTML:null:this.each(function(i){var t=this.innerHTML;jc(this).empty().append(Zc(this,a,i,t))})},text(e){return 0===arguments.length?0<this.length?this[0].textContent:null:this.each(function(){this.textContent=e===hc?"":""+e})},attr(a,e){var i;return"string"==typeof a&&e===hc?0==this.length||1!==this[0].nodeType?hc:"value"==a&&"INPUT"==this[0].nodeName?this.val():!(i=this[0].getAttribute(a))&&a in this[0]?this[0][a]:i:this.each(function(i){if(1===this.nodeType)if(Rc(a))for(ic in a)$c(this,ic,a[ic]);else $c(this,a,Zc(this,e,i,this.getAttribute(a)))})},removeAttr(e){return this.each(function(){1===this.nodeType&&$c(this,e)})},prop(a,o){return a=Lc[a]||a,o===hc?this[0]&&this[0][a]:this.each(function(e){this[a]=Zc(this,o,e,this[a])})},data(a,t){var e=this.attr("data-"+a.replace(Ac,"-$1").toLowerCase(),t);return null===e?hc:ad(e)},val(a){return 0===arguments.length?this[0]&&(this[0].multiple?jc(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(e){this.value=Zc(this,a,e,this.value)})},offset(o){if(o)return this.each(function(s){var t=jc(this),e=Zc(this,o,s,t.offset()),i=t.offsetParent().offset(),r={top:e.top-i.top,left:e.left-i.left};"static"==t.css("position")&&(r.position="relative"),t.css(r)});if(0==this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css(o,t){if(2>arguments.length){var r=this[0],i=getComputedStyle(r,"");if(!r)return;if("string"==typeof o)return r.style[lc(o)]||i.getPropertyValue(o);if(Mc(o)){var l={};return jc.each(Mc(o)?o:[o],function(a,t){l[t]=r.style[lc(t)]||i.getPropertyValue(t)}),l}}var e="";if("string"==Nc(o))t||0===t?e=Uc(o)+":"+Wc(o,t):this.each(function(){this.style.removeProperty(Uc(o))});else for(ic in o)o[ic]||0===o[ic]?e+=Uc(ic)+":"+Wc(ic,o[ic])+";":this.each(function(){this.style.removeProperty(Uc(ic))});return this.each(function(){this.style.cssText+=";"+e})},index(e){return e?this.indexOf(jc(e)[0]):this.parent().children().indexOf(this[0])},hasClass(e){return!!e&&nc.some.call(this,function(e){return this.test(_c(e))},Vc(e))},addClass(a){return a?this.each(function(i){kc=[];var t=_c(this);Zc(this,a,i,t).split(/\s+/g).forEach(function(e){jc(this).hasClass(e)||kc.push(e)},this),kc.length&&_c(this,t+(t?" ":"")+kc.join(" "))}):this},removeClass(a){return this.each(function(e){return a===hc?_c(this,""):void(kc=_c(this),Zc(this,a,e,kc).split(/\s+/g).forEach(function(e){kc=kc.replace(Vc(e)," ")}),_c(this,kc.trim()))})},toggleClass(a,i){return a?this.each(function(o){var s=jc(this);Zc(this,a,o,_c(this)).split(/\s+/g).forEach(function(e){(i===hc?!s.hasClass(e):i)?s.addClass(e):s.removeClass(e)})}):this},scrollTop(a){if(this.length){var t=("scrollTop"in this[0]);return a===hc?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=a}:function(){this.scrollTo(this.scrollX,a)})}},scrollLeft(a){if(this.length){var t=("scrollLeft"in this[0]);return a===hc?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=a}:function(){this.scrollTo(a,this.scrollY)})}},position(){if(this.length){var a=this[0],t=this.offsetParent(),e=this.offset(),i=zc.test(t[0].nodeName)?{top:0,left:0}:t.offset();return e.top-=parseFloat(jc(a).css("margin-top"))||0,e.left-=parseFloat(jc(a).css("margin-left"))||0,i.top+=parseFloat(jc(t[0]).css("border-top-width"))||0,i.left+=parseFloat(jc(t[0]).css("border-left-width"))||0,{top:e.top-i.top,left:e.left-i.left}}},offsetParent(){return this.map(function(){for(var e=this.offsetParent||qc.body;e&&!zc.test(e.nodeName)&&"static"==jc(e).css("position");)e=e.offsetParent;return e})}},jc.fn.detach=jc.fn.remove,["width","height"].forEach(function(o){var s=o.replace(/./,function(e){return e[0].toUpperCase()});jc.fn[o]=function(a){var e,r=this[0];return a===hc?Pc(r)?r["inner"+s]:Qc(r)?r.documentElement["scroll"+s]:(e=this.offset())&&e[o]:this.each(function(e){(r=jc(this)).css(o,Zc(this,a,e,r[o]()))})}}),["after","prepend","before","append"].forEach(function(a,r){var s=r%2;jc.fn[a]=function(){var o,l,d=jc.map(arguments,function(e){return"object"==(o=Nc(e))||"array"==o||null==e?e:Jc.fragment(e)}),c=1<this.length;return 1>d.length?this:this.each(function(a,i){l=s?i:i.parentNode,i=0==r?i.nextSibling:1==r?i.firstChild:2==r?i:null,d.forEach(function(e){if(c)e=e.cloneNode(!0);else if(!l)return jc(e).remove();!function a(t,e){for(var i in e(t),t.childNodes)a(t.childNodes[i],e)}(l.insertBefore(e,i),function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},jc.fn[s?a+"To":"insert"+(r?"Before":"After")]=function(e){return jc(e)[a](this),this}}),Jc.Z.prototype=jc.fn,Jc.uniq=mc,Jc.deserializeValue=ad,jc.zepto=Jc,jc);window.Zepto=vc,void 0===window.$&&(window.$=vc),function(b){function c(e){return"string"==typeof e}function D(e){return e._zid||(e._zid=d++)}function l(o,r,l,i){if((r=p(r)).ns)var d=(t=r.ns,new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)"));var t;return(_[D(o)]||[]).filter(function(e){return e&&(!r.e||e.e==r.e)&&(!r.ns||d.test(e.ns))&&(!l||D(e.fn)===D(l))&&(!i||e.sel==i)})}function p(a){var t=(""+a).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function g(a,t){return a.del&&!s&&a.e in i||!!t}function v(e){return S[e]||s&&i[e]||e}function h(d,a,c,m,s,o,r){var t=D(d),l=_[t]||(_[t]=[]);a.split(/\s/).forEach(function(e){if("ready"==e)return b(document).ready(c);var a=p(e);a.fn=c,a.sel=s,a.e in S&&(c=function(i){var t=i.relatedTarget;if(!t||t!==this&&!b.contains(this,t))return a.fn.apply(this,arguments)});var i=(a.del=o)||c;a.proxy=function(a){if(!(a=y(a)).isImmediatePropagationStopped()){a.data=m;var o=i.apply(d,a._args==T?[a]:[a].concat(a._args));return!1===o&&(a.preventDefault(),a.stopPropagation()),o}},a.i=l.length,l.push(a),"addEventListener"in d&&d.addEventListener(v(a.e),a.proxy,g(a,r))})}function o(o,e,r,i,d){var a=D(o);(e||"").split(/\s/).forEach(function(e){l(o,e,r,i).forEach(function(e){delete _[a][e.i],"removeEventListener"in o&&o.removeEventListener(v(e.e),e.proxy,g(e,d))})})}function y(o,s){return!s&&o.isDefaultPrevented||(s=s||o,b.each(x,function(a,t){var e=s[a];o[a]=function(){return this[t]=f,e&&e.apply(s,arguments)},o[t]=L}),(s.defaultPrevented===T?"returnValue"in s?!1===s.returnValue:s.getPreventDefault&&s.getPreventDefault():s.defaultPrevented)&&(o.isDefaultPrevented=f)),o}function w(a){var t,o={originalEvent:a};for(t in a)r.test(t)||a[t]===T||(o[t]=a[t]);return y(o,a)}b.zepto.qsa;var T,d=1,E=Array.prototype.slice,u=b.isFunction,_={},m={},s=("onfocusin"in window),i={focus:"focusin",blur:"focusout"},S={mouseenter:"mouseover",mouseleave:"mouseout"};m.click=m.mousedown=m.mouseup=m.mousemove="MouseEvents",b.event={add:h,remove:o},b.proxy=function(a,t){if(u(a)){function e(){return a.apply(t,arguments)}return e._zid=D(a),e}if(c(t))return b.proxy(a[t],a);throw new TypeError("expected function")},b.fn.bind=function(a,t,e){return this.on(a,t,e)},b.fn.unbind=function(a,t){return this.off(a,t)},b.fn.one=function(a,t,e,i){return this.on(a,t,e,i,1)};var f=function(){return!0},L=function(){return!1},r=/^([A-Z]|returnValue$|layer[XY]$)/,x={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};b.fn.delegate=function(a,t,e){return this.on(t,a,e)},b.fn.undelegate=function(a,t,e){return this.off(t,a,e)},b.fn.live=function(a,t){return b(document.body).delegate(this.selector,a,t),this},b.fn.die=function(a,t){return b(document.body).undelegate(this.selector,a,t),this},b.fn.on=function(d,_,m,p,g){var f,e,y=this;return d&&!c(d)?(b.each(d,function(a,t){y.on(a,_,m,t,g)}),y):(c(_)||u(p)||!1===p||(p=m,m=_,_=T),!u(m)&&!1!==m||(p=m,m=T),!1===p&&(p=L),y.each(function(a,s){g&&(f=function(e){return o(s,e.type,p),p.apply(this,arguments)}),_&&(e=function(a){var t,o=b(a.target).closest(_,s).get(0);if(o&&o!==s)return t=b.extend(w(a),{currentTarget:o,liveFired:s}),(f||p).apply(o,[t].concat(E.call(arguments,1)))}),h(s,d,p,m,_,e||f)}))},b.fn.off=function(a,s,t){var r=this;return a&&!c(a)?(b.each(a,function(a,t){r.off(a,s,t)}),r):(c(s)||u(t)||!1===t||(t=s,s=T),!1===t&&(t=L),r.each(function(){o(this,a,t,s)}))},b.fn.trigger=function(a,i){return(a=c(a)||b.isPlainObject(a)?b.Event(a):y(a))._args=i,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(a):b(this).triggerHandler(a,i)})},b.fn.triggerHandler=function(o,i){var r,d;return this.each(function(a,t){(r=w(c(o)?b.Event(o):o))._args=i,r.target=t,b.each(l(t,o.type||o),function(a,t){if(d=t.proxy(r),r.isImmediatePropagationStopped())return!1})}),d},["focusin","focusout","load","resize","scroll","unload","click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","change","select","keydown","keypress","keyup","error"].forEach(function(a){b.fn[a]=function(e){return e?this.bind(a,e):this.trigger(a)}}),["focus","blur"].forEach(function(a){b.fn[a]=function(e){return e?this.bind(a,e):this.each(function(){try{this[a]()}catch(e){}}),this}}),b.Event=function(o,s){c(o)||(o=(s=o).type);var r=document.createEvent(m[o]||"Events"),i=!0;if(s)for(var l in s)"bubbles"==l?i=!!s[l]:r[l]=s[l];return r.initEvent(o,i,!0),y(r)}}(vc),function(xk){function Jk(r,t,e,i){if(r.global)return l=t||zk,d=i,c=xk.Event(e),xk(l).trigger(c,d),!c.isDefaultPrevented();var l,d,c}function Mk(a,t){var e=t.context;return!1!==t.beforeSend.call(e,a,t)&&!1!==Jk(t,e,"ajaxBeforeSend",[a,t])&&void Jk(t,e,"ajaxSend",[a,t])}function Nk(o,t,e,i){var s=e.context;e.success.call(s,o,"success",t),i&&i.resolveWith(s,[o,"success",t]),Jk(e,s,"ajaxSuccess",[t,e,o]),Pk("success",t,e)}function Ok(o,t,e,i,r){var a=i.context;i.error.call(a,e,t,o),r&&r.rejectWith(a,[e,t,o]),Jk(i,a,"ajaxError",[e,i,o||t]),Pk(t,e,i)}function Pk(o,t,e){var i,s=e.context;e.complete.call(s,t,o),Jk(e,s,"ajaxComplete",[t,e]),(i=e).global&&! --xk.active&&Jk(i,null,"ajaxStop")}function Qk(){}function Sk(a,t){return""==t?a:(a+"&"+t).replace(/[&?]{1,2}/,"?")}function Uk(o,t,e,i){var s=!xk.isFunction(t);return{url:o,data:s?t:void 0,success:s?xk.isFunction(e)?e:void 0:t,dataType:s&&i||e}}var Ak,Bk,yk=0,zk=window.document,Ck=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Dk=/^(?:text|application)\/javascript/i,Ek=/^(?:text|application)\/xml/i,Fk="application/json",Gk="text/html",Hk=/^\s*$/;xk.active=0,xk.ajaxJSONP=function(d,i){function c(e){xk(o).triggerHandler("error",e||"abort")}if(!("type"in d))return xk.ajax(d);var _,m,t=d.jsonpCallback,p=(xk.isFunction(t)?t():t)||"jsonp"+ ++yk,o=zk.createElement("script"),r=window[p],u={abort:c};return i&&i.promise(u),xk(o).on("load error",function(a,t){clearTimeout(m),xk(o).off().remove(),"error"!=a.type&&_?Nk(_[0],u,d,i):Ok(null,t||"error",u,d,i),window[p]=r,_&&xk.isFunction(r)&&r(_[0]),r=_=void 0}),!1===Mk(u,d)?c("abort"):(window[p]=function(){_=arguments},o.src=d.url.replace(/\?(.+)=\?/,"?$1="+p),zk.head.appendChild(o),0<d.timeout&&(m=setTimeout(function(){c("timeout")},d.timeout))),u},xk.ajaxSettings={type:"GET",beforeSend:Qk,success:Qk,error:Qk,complete:Qk,context:null,global:!0,xhr(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},xk.ajax=function(Pl){var dl,Ol,Ql=xk.extend({},Pl||{}),Rl=xk.Deferred&&xk.Deferred();for(Ak in xk.ajaxSettings)void 0===Ql[Ak]&&(Ql[Ak]=xk.ajaxSettings[Ak]);(dl=Ql).global&&0==xk.active++&&Jk(dl,null,"ajaxStart"),Ql.crossDomain||(Ql.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(Ql.url)&&RegExp.$2!=window.location.host),Ql.url||(Ql.url=window.location.toString()),(Ol=Ql).processData&&Ol.data&&"string"!=xk.type(Ol.data)&&(Ol.data=xk.param(Ol.data,Ol.traditional)),!Ol.data||Ol.type&&"GET"!=Ol.type.toUpperCase()||(Ol.url=Sk(Ol.url,Ol.data),Ol.data=void 0),!1===Ql.cache&&(Ql.url=Sk(Ql.url,"_="+Date.now()));var Sl=Ql.dataType,Tl=/\?.+=\?/.test(Ql.url);if("jsonp"==Sl||Tl)return Tl||(Ql.url=Sk(Ql.url,Ql.jsonp?Ql.jsonp+"=?":!1===Ql.jsonp?"":"callback=?")),xk.ajaxJSONP(Ql,Rl);var $l,Ul=Ql.accepts[Sl],Vl={},Wl=function(a,t){Vl[a.toLowerCase()]=[a,t]},Xl=/^([\w-]+:)\/\//.test(Ql.url)?RegExp.$1:window.location.protocol,Yl=Ql.xhr(),Zl=Yl.setRequestHeader;if(Rl&&Rl.promise(Yl),Ql.crossDomain||Wl("X-Requested-With","XMLHttpRequest"),Wl("Accept",Ul||"*/*"),(Ul=Ql.mimeType||Ul)&&(-1<Ul.indexOf(",")&&(Ul=Ul.split(",",2)[0]),Yl.overrideMimeType&&Yl.overrideMimeType(Ul)),(Ql.contentType||!1!==Ql.contentType&&Ql.data&&"GET"!=Ql.type.toUpperCase())&&Wl("Content-Type",Ql.contentType||"application/x-www-form-urlencoded"),Ql.headers)for(Bk in Ql.headers)Wl(Bk,Ql.headers[Bk]);if(Yl.setRequestHeader=Wl,Yl.onreadystatechange=function(){if(4==Yl.readyState){Yl.onreadystatechange=Qk,clearTimeout($l);var cm,dm=!1;if(200<=Yl.status&&300>Yl.status||304==Yl.status||0==Yl.status&&"file:"==Xl){Sl=Sl||((Ll=Ql.mimeType||Yl.getResponseHeader("content-type"))&&(Ll=Ll.split(";",2)[0]),Ll&&("text/html"==Ll?"html":"application/json"==Ll?"json":Dk.test(Ll)?"script":Ek.test(Ll)&&"xml")||"text"),cm=Yl.responseText;try{"script"==Sl?eval(cm):"xml"==Sl?cm=Yl.responseXML:"json"==Sl&&(cm=Hk.test(cm)?null:xk.parseJSON(cm))}catch(e){dm=e}dm?Ok(dm,"parsererror",Yl,Ql,Rl):Nk(cm,Yl,Ql,Rl)}else Ok(Yl.statusText||null,Yl.status?"error":"abort",Yl,Ql,Rl)}var Ll},!1===Mk(Yl,Ql))return Yl.abort(),Ok(null,"abort",Yl,Ql,Rl),Yl;if(Ql.xhrFields)for(Bk in Ql.xhrFields)Yl[Bk]=Ql.xhrFields[Bk];var _l=!("async"in Ql)||Ql.async;for(Bk in Yl.open(Ql.type,Ql.url,_l,Ql.username,Ql.password),Vl)Zl.apply(Yl,Vl[Bk]);return 0<Ql.timeout&&($l=setTimeout(function(){Yl.onreadystatechange=Qk,Yl.abort(),Ok(null,"timeout",Yl,Ql,Rl)},Ql.timeout)),Yl.send(Ql.data?Ql.data:null),Yl},xk.get=function(){return xk.ajax(Uk.apply(null,arguments))},xk.post=function(){var e=Uk.apply(null,arguments);return e.type="POST",xk.ajax(e)},xk.getJSON=function(){var e=Uk.apply(null,arguments);return e.dataType="json",xk.ajax(e)},xk.fn.load=function(l,t,e){if(!this.length)return this;var i,d=this,a=l.split(/\s/),s=Uk(l,t,e),o=s.success;return 1<a.length&&(s.url=a[0],i=a[1]),s.success=function(e){d.html(i?xk("<div>").html(e.replace(Ck,"")).find(i):e),o&&o.apply(d,arguments)},xk.ajax(s),this};var Vk=encodeURIComponent;xk.param=function(a,t){var e=[];return e.add=function(a,t){this.push(Vk(a)+"="+Vk(t))},function d(i,e,c,a){var s,_=xk.isArray(e),r=xk.isPlainObject(e);xk.each(e,function(o,l){s=xk.type(l),a&&(o=c?a:a+"["+(r||"object"==s||"array"==s?o:"")+"]"),!a&&_?i.add(l.name,l.value):"array"!=s&&(c||"object"!=s)?i.add(o,l):d(i,l,c,o)})}(e,a,t),e.join("&").replace(/%20/g,"+")}}(vc),(Um=vc).fn.serializeArray=function(){var a,o=[];return Um([].slice.call(this.get(0).elements)).each(function(){var e=(a=Um(this)).attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=e&&"reset"!=e&&"button"!=e&&("radio"!=e&&"checkbox"!=e||this.checked)&&o.push({name:a.attr("name"),value:a.val()})}),o},Um.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(e){a.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),a.join("&")},Um.fn.submit=function(a){if(a)this.bind("submit",a);else if(this.length){var t=Um.Event("submit");this.eq(0).trigger(t),t.isDefaultPrevented()||this.get(0).submit()}return this},function(a){"__proto__"in{}||a.extend(a.zepto,{Z(i,o){return i=i||[],a.extend(i,a.fn),i.selector=o||"",i.__Z=!0,i},isZ(e){return"array"===a.type(e)&&"__Z"in e}});try{getComputedStyle(void 0)}catch(e){var i=getComputedStyle;window.getComputedStyle=function(a,t){try{return i(a,t)}catch(e){return null}}}}(vc),uc.getJSON=vc.getJSON,uc.ajax=vc.ajax}(TL),TL.Class=function(){},TL.Class.extend=function(o){function t(){this.initialize&&this.initialize.apply(this,arguments)}function e(){}e.prototype=this.prototype;var i=new e;for(var s in(i.constructor=t).prototype=i,t.superclass=this.prototype,this)this.hasOwnProperty(s)&&"prototype"!==s&&"superclass"!==s&&(t[s]=this[s]);return o.statics&&(TL.Util.extend(t,o.statics),delete o.statics),o.includes&&(TL.Util.extend.apply(null,[i].concat(o.includes)),delete o.includes),o.options&&i.options&&(o.options=TL.Util.extend({},i.options,o.options)),TL.Util.extend(i,o),t.extend=TL.Class.extend,t.include=function(e){TL.Util.extend(this.prototype,e)},t},TL.Events={addEventListener(a,t,e){var i=this._tl_events=this._tl_events||{};return i[a]=i[a]||[],i[a].push({action:t,context:e||this}),this},hasEventListeners(e){return"_tl_events"in this&&e in this._tl_events&&0<this._tl_events[e].length},removeEventListener(o,t,e){if(!this.hasEventListeners(o))return this;for(var i=0,r=this._tl_events,a=r[o].length;i<a;i++)if(r[o][i].action===t&&(!e||r[o][i].context===e))return r[o].splice(i,1),this;return this},fireEvent(o,t){if(!this.hasEventListeners(o))return this;for(var e=TL.Util.mergeData({type:o,target:this},t),i=this._tl_events[o].slice(),r=0,l=i.length;r<l;r++)i[r].action.call(i[r].context||this,e);return this}},TL.Events.on=TL.Events.addEventListener,TL.Events.off=TL.Events.removeEventListener,TL.Events.fire=TL.Events.fireEvent,function(){var p=navigator.userAgent.toLowerCase(),t=document.documentElement,e=("ActiveXObject"in window),i=-1!==p.indexOf("webkit"),g=-1!==p.indexOf("phantom"),a=-1!==p.search("android [23]"),s="undefined"!=typeof orientation,o=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,r=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||o,l=e&&"transition"in t.style,h="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!a,c=("MozPerspective"in t.style),d=("OTransition"in t.style),u=(window.opera,"devicePixelRatio"in window&&1<window.devicePixelRatio);if(!u&&"matchMedia"in window){var y=window.matchMedia("(min-resolution:144dpi)");u=y&&y.matches}var m=!window.L_NO_TOUCH&&!g&&(r||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);TL.Browser={ie:e,ua:p,ie9:!!(e&&p.match(/MSIE 9/i)),ielt9:e&&!document.addEventListener,webkit:i,firefox:-1!==p.indexOf("gecko")&&!i&&!window.opera&&!e,android:-1!==p.indexOf("android"),android23:a,chrome:-1!==p.indexOf("chrome"),edge:-1!==p.indexOf("edge/"),ie3d:l,webkit3d:h,gecko3d:c,opera3d:d,any3d:!window.L_DISABLE_3D&&(l||h||c||d)&&!g,mobile:s,mobileWebkit:s&&i,mobileWebkit3d:s&&h,mobileOpera:s&&window.opera,touch:!!m,msPointer:!!o,pointer:!!r,retina:!!u,orientation(){var a=window.innerWidth,t="portrait";return window.innerHeight<a&&(t="landscape"),Math.abs(window.orientation),trace(t),t}}}(),TL.Load=function(){function o(o){var t=0,s=!1;for(t=0;t<a.length;t++)a[t]==o&&(s=!0);return s||(a.push(o),0)}var a=[];return{css(a,t,e,i){o(a)?t():TL.LoadIt.css(a,t,e,i)},js(a,t,e,i){o(a)?t():TL.LoadIt.js(a,t,e,i)}}}(this.document),TL.LoadIt=function(b){function e(a,t){var e,o=b.createElement(a);for(e in t)t.hasOwnProperty(e)&&o.setAttribute(e,t[e]);return o}function o(a){var t,o,l=D[a];l&&(t=l.callback,(o=l.urls).shift(),s=0,o.length||(t&&t.call(l.context,l.obj),D[a]=null,v[a].length&&r(a)))}function r(p,g,y,i,w){function a(){o(p)}var s,T,E,S,L,M,C,N="css"===p,_=[];if(f||(C=navigator.userAgent,((f={async:!0===b.createElement("script").async}).webkit=/AppleWebKit\//.test(C))||(f.ie=/MSIE/.test(C))||(f.opera=/Opera/.test(C))||(f.gecko=/Gecko\//.test(C))||(f.unknown=!0)),g)if(g="string"==typeof g?[g]:g.concat(),N||f.async||f.gecko||f.opera)v[p].push({urls:g,callback:y,obj:i,context:w});else for(s=0,T=g.length;s<T;++s)v[p].push({urls:[g[s]],callback:s===T-1?y:null,obj:i,context:w});if(!D[p]&&(S=D[p]=v[p].shift())){for(x=x||b.head||b.getElementsByTagName("head")[0],s=0,T=(L=S.urls).length;s<T;++s)M=L[s],N?E=f.gecko?e("style"):e("link",{href:M,rel:"stylesheet"}):(E=e("script",{src:M})).async=!1,E.className="lazyload",E.setAttribute("charset","utf-8"),f.ie&&!N?E.onreadystatechange=function(){/loaded|complete/.test(E.readyState)&&(E.onreadystatechange=null,a())}:N&&(f.gecko||f.webkit)?f.webkit?(S.urls[s]=E.href,u()):(E.innerHTML="@import \""+M+"\";",t(E)):E.onload=E.onerror=a,_.push(E);for(s=0,T=_.length;s<T;++s)x.appendChild(_[s])}}function t(a){var e;try{e=!!a.sheet.cssRules}catch(i){return void(200>(s+=1)?setTimeout(function(){t(a)},50):e&&o("css"))}o("css")}function u(){var a,i=D.css;if(i){for(a=l.length;0<=--a;)if(l[a].href===i.urls[0]){o("css");break}s+=1,i&&(200>s?setTimeout(u,50):o("css"))}}var f,x,D={},s=0,v={css:[],js:[]},l=b.styleSheets;return{css(a,t,e,i){r("css",a,t,e,i)},js(a,t,e,i){r("js",a,t,e,i)}}}(this.document),TL.TimelineConfig=TL.Class.extend({includes:[],initialize(a){if(this.title="",this.scale="",this.events=[],this.eras=[],this.event_dict={},this.messages={errors:[],warnings:[]},"object"==typeof a&&a.events){if(this.scale=a.scale,this.events=[],this._ensureValidScale(a.events),a.title){var t=this._assignID(a.title);this._tidyFields(a.title),this.title=a.title,this.event_dict[t]=this.title}for(var e=0;e<a.events.length;e++)try{this.addEvent(a.events[e],!0)}catch(e){this.logError(e)}if(a.eras)for(e=0;e<a.eras.length;e++)try{this.addEra(a.eras[e],!0)}catch(a){this.logError("Era "+e+": "+a)}TL.DateUtil.sortByDate(this.events),TL.DateUtil.sortByDate(this.eras)}},logError(e){trace(e),this.messages.errors.push(e)},getErrors(e){return e?this.messages.errors.join(e):this.messages.errors},validate(){void 0!==this.events&&void 0!==this.events.length&&0!=this.events.length||this.logError("Timeline configuration has no events.");for(var a=0;a<this.eras.length;a++){var i;void 0!==this.eras[a].start_date&&void 0!==this.eras[a].end_date||(i=this.eras[a].text&&this.eras[a].text.headline?this.eras[a].text.headline:"era "+(a+1),this.logError("All eras must have start and end dates. ["+i+"]"))}},isValid(){return 0==this.messages.errors.length},addEvent(a,t){var e=this._assignID(a);if(void 0===a.start_date)throw new TL.Error("missing_start_date_err",e);return this._processDates(a),this._tidyFields(a),this.events.push(a),this.event_dict[e]=a,t||TL.DateUtil.sortByDate(this.events),e},addEra(a,t){var e=this._assignID(a);if(void 0===a.start_date)throw new TL.Error("missing_start_date_err",e);return this._processDates(a),this._tidyFields(a),this.eras.push(a),this.event_dict[e]=a,t||TL.DateUtil.sortByDate(this.eras),e},_assignID(a){var t=a.unique_id;return TL.Util.trim(t)||(t=a.text?TL.Util.slugify(a.text.headline):null),a.unique_id=TL.Util.ensureUniqueKey(this.event_dict,t),a.unique_id},_makeUniqueIdentifiers(o,t){for(var e=[o],i=0;i<t.length;i++)TL.Util.trim(t[i].unique_id)&&(t[i].unique_id=TL.Util.slugify(t[i].unique_id),-1==e.indexOf(t[i].unique_id)?e.push(t[i].unique_id):t[i].unique_id="");if(e.length!=t.length+1)for(i=0;i<t.length;i++)if(!t[i].unique_id){var s=t[i].text?TL.Util.slugify(t[i].text.headline):null;s=s||TL.Util.unique_ID(6),-1!=e.indexOf(s)&&(s=s+"-"+i),e.push(s),t[i].unique_id=s}},_ensureValidScale(a){if(!this.scale){trace("Determining scale dynamically"),this.scale="human";for(var t=0;t<a.length;t++){if("cosmological"==a[t].scale){this.scale="cosmological";break}if(a[t].start_date&&void 0!==a[t].start_date.year){var o=new TL.BigDate(a[t].start_date).data.date_obj.year;if(-271820>o||275759<o){this.scale="cosmological";break}}}}TL.DateUtil.SCALE_DATE_CLASSES[this.scale]||this.logError("Don't know how to process dates on scale "+this.scale)},_processDates(o){var t=TL.DateUtil.SCALE_DATE_CLASSES[this.scale];if(!(o.start_date instanceof t)){var e=o.start_date;if(o.start_date=new t(e),void 0!==o.end_date&&!(o.end_date instanceof t)){var i=o.end_date,s=!0;for(property in e)s=s&&e[property]==i[property];s?(trace("End date same as start date is redundant; dropping end date"),delete o.end_date):o.end_date=new t(i)}}},getEarliestDate(){var e=this.events[0].start_date;return this.eras&&0<this.eras.length&&this.eras[0].start_date.isBefore(e)?this.eras[0].start_date:e},getLatestDate(){for(var a=[],t=0;t<this.events.length;t++)this.events[t].end_date?a.push({date:this.events[t].end_date}):a.push({date:this.events[t].start_date});for(t=0;t<this.eras.length;t++)this.eras[t].end_date?a.push({date:this.eras[t].end_date}):a.push({date:this.eras[t].start_date});return TL.DateUtil.sortByDate(a,"date"),a.slice(-1)[0].date},_tidyFields(a){function t(a,t,e){e=e||"",a.hasOwnProperty(t)||(a[t]=e)}a.group&&(a.group=TL.Util.trim(a.group)),a.text||(a.text={}),t(a.text,"text"),t(a.text,"headline")}}),TL.Language=function(o){for(k in TL.Language.languages.en)this[k]=TL.Language.languages.en[k];if(o&&o.language&&"string"==typeof o.language&&"en"!=o.language){var t=o.language;if(!(t in TL.Language.languages)){if(/\.json$/.test(t))var e=t;else{var r="/locale/"+t+".json",l=o.script_path||TL.Timeline.source_path;/\/$/.test(l)&&(r=r.substr(1)),e=l+r}var a=TL.ajax({url:e,async:!1});if(200!=a.status)throw"Could not load language ["+t+"]: "+a.statusText;TL.Language.languages[t]=JSON.parse(a.responseText)}TL.Util.mergeData(this,TL.Language.languages[t])}},TL.Language.formatNumber=function(a,o){if(o.match(/%(\.(\d+))?f/)){var e=o.match(/%(\.(\d+))?f/),i=e[0];return e[2]&&(a=a.toFixed(e[2])),o.replace(i,a)}return o},TL.Language.prototype.mergeData=function(e){for(k in TL.Language.languages.en)e[k]&&("object"==typeof this[k]?TL.Util.mergeData(e[k],this[k]):this[k]=e[k])},TL.Language.fallback={messages:{}},TL.Language.prototype.getMessage=function(e){return this.messages[e]||TL.Language.fallback.messages[e]||e},TL.Language.prototype._=TL.Language.prototype.getMessage,TL.Language.prototype.formatDate=function(a,t){return a.constructor==Date?this.formatJSDate(a,t):a.constructor==TL.BigYear?this.formatBigYear(a,t):a.data&&a.data.date_obj?this.formatDate(a.data.date_obj,t):(trace("Unfamiliar date presented for formatting"),a.toString())},TL.Language.prototype.formatBigYear=function(o,t){var e=o.year,i=this.bigdateformats[t]||this.bigdateformats.fallback;if(i){for(var r,l=0;l<i.length;l++)if(r=i[l],1<Math.abs(e/r[0]))return TL.Language.formatNumber(Math.abs(e/r[0]),r[1]);return e.toString()}return trace("Language file dateformats missing cosmological. Falling back."),TL.Language.formatNumber(e,t)},TL.Language.prototype.formatJSDate=function(p,t){function g(a,o){var e=y.period_labels[a];return e&&(a=12>o?e[0]:e[1]),"<span class='tl-timeaxis-timesuffix'>"+a+"</span>"}var y=this;t=t||"full";var i=this.dateformats[t]||TL.Language.fallback.dateformats[t];i=i||t;var v=p.getDate(),s=p.getDay(),o=p.getMonth(),r=p.getFullYear(),l=p.getHours(),h=p.getMinutes(),c=p.getSeconds(),d=p.getMilliseconds(),u=p.getTimezoneOffset(),_={d:v,dd:TL.Util.pad(v),ddd:this.date.day_abbr[s],dddd:this.date.day[s],m:o+1,mm:TL.Util.pad(o+1),mmm:this.date.month_abbr[o],mmmm:this.date.month[o],yy:(r+"").slice(2),yyyy:0>r&&this.has_negative_year_modifier()?Math.abs(r):r,h:l%12||12,hh:TL.Util.pad(l%12||12),H:l,HH:TL.Util.pad(l),M:h,MM:TL.Util.pad(h),s:c,ss:TL.Util.pad(c),l:TL.Util.pad(d,3),L:TL.Util.pad(99<d?Math.round(d/10):d),t:g("t",l),tt:g("tt",l),T:g("T",l),TT:g("TT",l),Z:((p+"").match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),o:(0<u?"-":"+")+TL.Util.pad(100*Math.floor(Math.abs(u)/60)+Math.abs(u)%60,4),S:["th","st","nd","rd"][3<v%10?0:(10!=v%100-v%10)*v%10]},m=i.replace(TL.Language.DATE_FORMAT_TOKENS,function(e){return e in _?_[e]:e.slice(1,e.length-1)});return this._applyEra(m,r)},TL.Language.prototype.has_negative_year_modifier=function(){return!!(this.era_labels.negative_year.prefix||this.era_labels.negative_year.suffix)},TL.Language.prototype._applyEra=function(a,t){var e=0>t?this.era_labels.negative_year:this.era_labels.positive_year,i="";return e.prefix&&(i+="<span>"+e.prefix+"</span> "),i+=a,e.suffix&&(i+=" <span>"+e.suffix+"</span>"),i},TL.Language.DATE_FORMAT_TOKENS=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,TL.Language.languages={en:{name:"English",lang:"en",api:{wikipedia:"en"},messages:{loading:"Loading",error:"Error",contract_timeline:"Contract Timeline",return_to_title:"Return to Title",loading_content:"Loading Content",expand_timeline:"Expand Timeline",loading_timeline:"Loading Timeline... ",swipe_to_navigate:"Swipe to Navigate<br><span class='tl-button'>OK</span>",empty_feed_err:"No data entries found",missing_start_date_err:"Missing start_date",invalid_data_format_err:"Header row has been modified.",date_compare_err:"Can't compare TL.Dates on different scales",invalid_scale_err:"Invalid scale",invalid_date_err:"Invalid date: month, day and year must be numbers.",invalid_separator_error:"Invalid time: misuse of : or . as separator.",invalid_hour_err:"Invalid time (hour)",invalid_minute_err:"Invalid time (minute)",invalid_second_err:"Invalid time (second)",invalid_fractional_err:"Invalid time (fractional seconds)",invalid_second_fractional_err:"Invalid time (seconds and fractional seconds)",invalid_year_err:"Invalid year",template_value_err:"No value provided for variable",time_scale_scale_err:"Don't know how to get date from time for scale",axis_helper_no_options_err:"Axis helper must be configured with options",axis_helper_scale_err:"No AxisHelper available for scale",invalid_integer_option:"Invalid option value\xE2\u20AC\u201Dmust be a whole number."},date:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."]},era_labels:{positive_year:{prefix:"",suffix:""},negative_year:{prefix:"",suffix:"BCE"}},period_labels:{t:["a","p"],tt:["am","pm"],T:["A","P"],TT:["AM","PM"]},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time:"h:MM:ss TT' <small>'mmmm d',' yyyy'</small>'",time_short:"h:MM:ss TT",time_no_seconds_short:"h:MM TT",time_no_minutes_short:"h TT",time_no_seconds_small_date:"h:MM TT' <small>'mmmm d',' yyyy'</small>'",time_milliseconds:"l",full_long:"mmm d',' yyyy 'at' h:MM TT",full_long_small_date:"h:MM TT' <small>mmm d',' yyyy'</small>'"},bigdateformats:{fallback:[[1e9,"%.2f billion years ago"],[1e6,"%.1f million years ago"],[1e3,"%.1f thousand years ago"],[1,"%f years ago"]],compact:[[1e9,"%.2f bya"],[1e6,"%.1f mya"],[1e3,"%.1f kya"],[1,"%f years ago"]],verbose:[[1e9,"%.2f billion years ago"],[1e6,"%.1f million years ago"],[1e3,"%.1f thousand years ago"],[1,"%f years ago"]]}}},TL.Language.fallback=new TL.Language,TL.I18NMixins={getLanguage(){return this.options&&this.options.language?this.options.language:(trace("Expected a language option"),TL.Language.fallback)},_(e){return this.getLanguage()._(e)}},TL.Easings={ease:[.25,.1,.25,1],linear:[0,0,1,1],easein:[.42,0,1,1],easeout:[0,0,.58,1],easeinout:[.42,0,.58,1]},TL.Ease={KeySpline(i){function r(a,t){return 1-3*t+3*a}function l(a,t){return 3*t-6*a}function _(e){return 3*e}function c(a,t,e){return((r(t,e)*a+l(t,e))*a+_(t))*a}this.get=function(e){return i[0]==i[1]&&i[2]==i[3]?e:c(function(d){for(var t,m=d,p=0;4>p;++p){if(t=(u=m,3*r(g=i[0],h=i[2])*u*u+2*l(g,h)*u+_(g)),0==t)return m;m-=(c(m,i[0],i[2])-d)/t}var u,g,h;return m}(e),i[1],i[3])}},easeInSpline(e){return new TL.Ease.KeySpline(TL.Easings.easein).get(e)},easeInOutExpo(e){return new TL.Ease.KeySpline(TL.Easings.easein).get(e)},easeOut(e){return Math.sin(e*Math.PI/2)},easeOutStrong(e){return 1==e?1:1-Math.pow(2,-10*e)},easeIn(e){return e*e},easeInStrong(e){return 0==e?0:Math.pow(2,10*(e-1))},easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack(e){return e*e*(2.70158*e-1.70158)},easeOutBack(e){return--e*e*(2.70158*e+1.70158)+1},bounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},swingTo(e){return--e*e*(2.70158*e+1.70158)+1},swingFrom(e){return e*e*(2.70158*e-1.70158)},elastic(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1},spring(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},blink(a,t){return Math.round(a*(t||5))%2},pulse(a,t){return-Math.cos(2*(a*((t||5)-.5))*Math.PI)/2+.5},wobble(e){return-Math.cos(e*Math.PI*(9*e))/2+.5},sinusoidal(e){return-Math.cos(e*Math.PI)/2+.5},flicker(e){return e+=(Math.random()-.5)/5,easings.sinusoidal(0>e?0:1<e?1:e)},mirror(e){return .5>e?easings.sinusoidal(2*e):easings.sinusoidal(1-2*(e-.5))},easeInQuad(e){return e*e},easeOutQuad(e){return e*(2-e)},easeInOutQuad(e){return .5>e?2*e*e:(4-2*e)*e-1},easeInCubic(e){return e*e*e},easeOutCubic(e){return--e*e*e+1},easeInOutCubic(e){return .5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart(e){return e*e*e*e},easeOutQuart(e){return 1- --e*e*e*e},easeInOutQuart(e){return .5>e?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint(e){return e*e*e*e*e},easeOutQuint(e){return 1+--e*e*e*e*e},easeInOutQuint(e){return .5>e?16*e*e*e*e*e:1+16*--e*e*e*e*e}},TL.Animate=function(a,t){return new tlanimate(a,t)},window.tlanimate=function(){function g(a){var o,s=v.length;for(j&&1e12<a&&(a=U()),p&&(a=U()),o=s;o--;)v[o](a);v.length&&b(g)}function _(a,t){var e,s={};return(e=a.match(o))&&(s.rotate=N(e[1],t?t.rotate:null)),(e=a.match(r))&&(s.scale=N(e[1],t?t.scale:null)),(e=a.match(l))&&(s.skewx=N(e[1],t?t.skewx:null),s.skewy=N(e[3],t?t.skewy:null)),(e=a.match(h))&&(s.translatex=N(e[1],t?t.translatex:null),s.translatey=N(e[3],t?t.translatey:null)),s}function m(a){var t="";return"rotate"in a&&(t+="rotate("+a.rotate+"deg) "),"scale"in a&&(t+="scale("+a.scale+") "),"translatex"in a&&(t+="translate("+a.translatex+"px,"+a.translatey+"px) "),"skewx"in a&&(t+="skew("+a.skewx+"deg,"+a.skewy+"deg)"),t}function f(a){var t=a.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return(t?"#"+(16777216|t[1]<<16|t[2]<<8|t[3]).toString(16).slice(1):a).replace(/#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")}function D(e){return e.replace(/-(.)/g,function(a,t){return t.toUpperCase()})}function E(e){return"function"==typeof e}function T(e){return Math.sin(e*Math.PI/2)}function S(a,p,s,y,x,l){y=E(y)?y:A.easings[y]||T;var t,D=a||1000,c=this,d=l-x,u=U(),_=0,w=0;return t=function o(t){var e,r,m=t-u;return D<m||_?(l=isFinite(l)?l:1,_?w&&p(l):p(l),0<=(r=function(a,t,e){if(Array.prototype.indexOf)return a.indexOf(t);for(e=0;e<a.length;++e)if(a[e]===t)return e}(v,o))&&(e=v.slice(r+1),v.length=r,v=v.concat(e)),s&&s.apply(c)):void(isFinite(l)?p(d*y(m/D)+x):p(y(m/D)))},1===v.push(t)&&b(g),{stop(e){_=1,(w=e)||(s=null)}}}function M(o,t){var e,r,l=o.length,a=[];for(e=0;e<l;++e)a[e]=[o[e][0],o[e][1]];for(r=1;r<l;++r)for(e=0;e<l-r;++e)a[e][0]=(1-t)*a[e][0]+t*a[parseInt(e+1,10)][0],a[e][1]=(1-t)*a[e][1]+t*a[parseInt(e+1,10)][1];return[a[0][0],a[0][1]]}function C(l,t,e,i,d,a,s){if("transform"!=d)return"string"==typeof e[a][d]?function(l,t,e){var i,d,c,_,m=[];for(i=0;6>i;i++)c=Math.min(15,parseInt(t.charAt(i),16)),_=Math.min(15,parseInt(e.charAt(i),16)),d=15<(d=Math.floor((_-c)*l+c))?15:0>d?0:d,m[i]=d.toString(16);return"#"+m.join("")}(l,e[a][d],i[a][d]):(s=Math.round(((i[a][d]-e[a][d])*l+e[a][d])*1000)/1000,d in c||(s+=t[a][d]||"px"),s);for(var _ in s={},e[a][d])s[_]=_ in i[a][d]?Math.round(((i[a][d][_]-e[a][d][_])*l+e[a][d][_])*1000)/1000:e[a][d][_];return s}function N(o,t,e,s,r){return(e=L.exec(o))?(r=parseFloat(e[2]))&&t+("+"==e[1]?1:-1)*r:parseFloat(o)}function A(b,L){var a,t,A,j=b?j=isFinite(b.length)?b:[b]:[],U=L.complete,I=L.duration,r=L.easing,l=L.bezier,h=[],c=[],d=[],u=[];for(l&&(t=L.left,A=L.top,delete L.right,delete L.bottom,delete L.left,delete L.top),a=j.length;a--;){if(h[a]={},c[a]={},d[a]={},l){var B=O(j[a],"left"),q=O(j[a],"top"),z=[N(E(t)?t(j[a]):t||0,parseFloat(B)),N(E(A)?A(j[a]):A||0,parseFloat(q))];u[a]=E(l)?l(j[a],z):l,u[a].push(z),u[a].unshift([parseInt(B,10),parseInt(q,10)])}for(var p in L){switch(p){case"complete":case"duration":case"easing":case"bezier":continue;}var g,H=O(j[a],p),y=E(L[p])?L[p](j[a]):L[p];"string"!=typeof y||!i.test(y)||i.test(H)?(h[a][p]="transform"==p?_(H):"string"==typeof y&&i.test(y)?f(H).slice(1):parseFloat(H),c[a][p]="transform"==p?_(y,h[a][p]):"string"==typeof y&&"#"==y.charAt(0)?f(y).slice(1):N(y,parseFloat(H)),"string"==typeof y&&(g=y.match(P))&&(d[a][p]=g[1])):delete L[p]}}return S.apply(j,[I,function(o,t,s){for(a=j.length;a--;)for(var r in l&&(s=M(u[a],o),j[a].style.left=s[0]+"px",j[a].style.top=s[1]+"px"),L)t=C(o,d,h,c,r,a),"transform"==r?j[a].style[x]=m(t):"opacity"!=r||w?j[a].style[D(r)]=t:j[a].style.filter="alpha(opacity="+100*t+")"},U,r])}var u=document,a=window,e=a.performance,j=e&&(e.now||e.webkitNow||e.msNow||e.mozNow),U=j?function(){return j.call(e)}:function(){return+new Date},t=u.documentElement,p=!1,i=/^rgb\(|#/,L=/^([+\-])=([\d\.]+)/,P=/^(?:[\+\-]=?)?\d+(?:\.\d+)?(%|in|cm|mm|em|ex|pt|pc|px)$/,o=/rotate\(((?:[+\-]=)?([\-\d\.]+))deg\)/,r=/scale\(((?:[+\-]=)?([\d\.]+))\)/,l=/skew\(((?:[+\-]=)?([\-\d\.]+))deg, ?((?:[+\-]=)?([\-\d\.]+))deg\)/,h=/translate\(((?:[+\-]=)?([\-\d\.]+))px, ?((?:[+\-]=)?([\-\d\.]+))px\)/,c={lineHeight:1,zoom:1,zIndex:1,opacity:1,transform:1},x=function(){var a,o=u.createElement("a").style,e=["webkitTransform","MozTransform","OTransform","msTransform","Transform"];for(a=0;a<e.length;a++)if(e[a]in o)return e[a]}(),w=void 0!==u.createElement("a").style.opacity,O=u.defaultView&&u.defaultView.getComputedStyle?function(a,t){t=D(t="transform"==t?x:t);var o=null,s=u.defaultView.getComputedStyle(a,"");return s&&(o=s[t]),a.style[t]||o}:t.currentStyle?function(a,t){if("opacity"==(t=D(t))){var o=100;try{o=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(t){try{o=a.filters("alpha").opacity}catch(t){}}return o/100}var s=a.currentStyle?a.currentStyle[t]:null;return a.style[t]||s}:function(a,t){return a.style[D(t)]},b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.msRequestAnimationFrame||a.oRequestAnimationFrame||function(e){a.setTimeout(function(){e(+new Date)},17)},v=[];return b(function(e){p=1e12<e!=1e12<U()}),A.tween=S,A.getStyle=O,A.bezier=M,A.transform=x,A.parseTransform=_,A.formatTransform=m,A.easings={},A}(),TL.Point=function(a,t,e){this.x=e?Math.round(a):a,this.y=e?Math.round(t):t},TL.Point.prototype={add(e){return this.clone()._add(e)},_add(e){return this.x+=e.x,this.y+=e.y,this},subtract(e){return this.clone()._subtract(e)},_subtract(e){return this.x-=e.x,this.y-=e.y,this},divideBy(a,t){return new TL.Point(this.x/a,this.y/a,t)},multiplyBy(e){return new TL.Point(this.x*e,this.y*e)},distanceTo(a){var t=a.x-this.x,e=a.y-this.y;return Math.sqrt(t*t+e*e)},round(){return this.clone()._round()},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},clone(){return new TL.Point(this.x,this.y)},toString(){return"Point("+TL.Util.formatNum(this.x)+", "+TL.Util.formatNum(this.y)+")"}},TL.DomMixins={show(e){e||(this._el.container.style.display="block")},hide(){this._el.container.style.display="none"},addTo(e){e.appendChild(this._el.container),this.onAdd()},removeFrom(e){e.removeChild(this._el.container),this.onRemove()},animatePosition(a,t){var e={duration:this.options.duration,easing:this.options.ease};for(var i in a)a.hasOwnProperty(i)&&(e[i]=a[i]+"px");this.animator&&this.animator.stop(),this.animator=TL.Animate(t,e)},onLoaded(){this.fire("loaded",this.data)},onAdd(){this.fire("added",this.data)},onRemove(){this.fire("removed",this.data)},setPosition(a,t){for(var e in a)a.hasOwnProperty(e)&&(t?t.style[e]=a[e]+"px":this._el.container.style[e]=a[e]+"px")},getPosition(){return TL.Dom.getPosition(this._el.container)}},TL.Dom={get(e){return"string"==typeof e?document.getElementById(e):e},getByClass(e){if(e)return document.getElementsByClassName(e)},create(a,t,e){var i=document.createElement(a);return i.className=t,e&&e.appendChild(i),i},createText(a,t){var e=document.createTextNode(a);return t&&t.appendChild(e),e},getTranslateString(e){return TL.Dom.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+TL.Dom.TRANSLATE_CLOSE},setPosition(a,t){a._tl_pos=t,TL.Browser.webkit3d?(a.style[TL.Dom.TRANSFORM]=TL.Dom.getTranslateString(t),TL.Browser.android&&(a.style["-webkit-perspective"]="1000",a.style["-webkit-backface-visibility"]="hidden")):(a.style.left=t.x+"px",a.style.top=t.y+"px")},getPosition(a){for(var i={x:0,y:0};a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)i.x+=a.offsetLeft,i.y+=a.offsetTop,a=a.offsetParent;return i},testProp(a){for(var t=document.documentElement.style,e=0;e<a.length;e++)if(a[e]in t)return a[e];return!1}},TL.Util.mergeData(TL.Dom,{TRANSITION:TL.Dom.testProp(["transition"]),TRANSFORM:TL.Dom.testProp(["transformProperty"]),TRANSLATE_OPEN:"translate"+(TL.Browser.webkit3d?"3d(":"("),TRANSLATE_CLOSE:TL.Browser.webkit3d?",0)":")"}),TL.DomUtil={get(e){return"string"==typeof e?document.getElementById(e):e},getStyle(a,t){var e=a.style[t];if(!e&&a.currentStyle&&(e=a.currentStyle[t]),!e||"auto"===e){var o=document.defaultView.getComputedStyle(a,null);e=o?o[t]:null}return"auto"===e?null:e},getViewportOffset(o){var t=0,s=0,r=o,l=document.body;do{if(t+=r.offsetTop||0,s+=r.offsetLeft||0,r.offsetParent===l&&"absolute"===TL.DomUtil.getStyle(r,"position"))break;r=r.offsetParent}while(r);r=o;do{if(r===l)break;t-=r.scrollTop||0,s-=r.scrollLeft||0,r=r.parentNode}while(r);return new TL.Point(s,t)},create(a,t,e){var i=document.createElement(a);return i.className=t,e&&e.appendChild(i),i},disableTextSelection(){document.selection&&document.selection.empty&&document.selection.empty(),this._onselectstart||(this._onselectstart=document.onselectstart,document.onselectstart=TL.Util.falseFn)},enableTextSelection(){document.onselectstart=this._onselectstart,this._onselectstart=null},hasClass(a,t){return 0<a.className.length&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(a.className)},addClass(a,t){TL.DomUtil.hasClass(a,t)||(a.className+=(a.className?" ":"")+t)},removeClass(e,a){e.className=e.className.replace(/(\S+)\s*/g,function(i,t){return t===a?"":i}).replace(/^\s+/,"")},setOpacity(a,t){a.style.opacity=t},testProp(a){for(var t=document.documentElement.style,e=0;e<a.length;e++)if(a[e]in t)return a[e];return!1},getTranslateString(e){return TL.DomUtil.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+TL.DomUtil.TRANSLATE_CLOSE},getScaleString(a,t){return TL.DomUtil.getTranslateString(t)+" scale("+a+") "+TL.DomUtil.getTranslateString(t.multiplyBy(-1))},setPosition(a,t){a._tl_pos=t,TL.Browser.webkit3d?(a.style[TL.DomUtil.TRANSFORM]=TL.DomUtil.getTranslateString(t),TL.Browser.android&&(a.style["-webkit-perspective"]="1000",a.style["-webkit-backface-visibility"]="hidden")):(a.style.left=t.x+"px",a.style.top=t.y+"px")},getPosition(e){return e._tl_pos}},TL.DomEvent={addListener(d,e,c,i){var t=TL.Util.stamp(c),a="_tl_"+e+t;if(!d[a]){var s=function(e){return c.call(i||d,e||TL.DomEvent._getEvent())};if(TL.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener)this.addDoubleTapListener(d,s,t);else if(!("addEventListener"in d))"attachEvent"in d&&d.attachEvent("on"+e,s);else if("mousewheel"===e)d.addEventListener("DOMMouseScroll",s,!1),d.addEventListener(e,s,!1);else if("mouseenter"===e||"mouseleave"===e){var _=s,r="mouseenter"===e?"mouseover":"mouseout";s=function(e){if(TL.DomEvent._checkMouse(d,e))return _(e)},d.addEventListener(r,s,!1)}else d.addEventListener(e,s,!1);d[a]=s}},removeListener(o,t,e){var i=TL.Util.stamp(e),r="_tl_"+t+i,a=o[r];a&&(TL.Browser.touch&&"dblclick"===t&&this.removeDoubleTapListener?this.removeDoubleTapListener(o,i):"removeEventListener"in o?"mousewheel"===t?(o.removeEventListener("DOMMouseScroll",a,!1),o.removeEventListener(t,a,!1)):"mouseenter"===t||"mouseleave"===t?o.removeEventListener("mouseenter"===t?"mouseover":"mouseout",a,!1):o.removeEventListener(t,a,!1):"detachEvent"in o&&o.detachEvent("on"+t,a),o[r]=null)},_checkMouse(a,t){var e=t.relatedTarget;if(!e)return!0;try{for(;e&&e!==a;)e=e.parentNode}catch(e){return!1}return e!==a},_getEvent(){var a=window.event;if(!a)for(var i=arguments.callee.caller;i&&(!(a=i.arguments[0])||window.Event!==a.constructor);)i=i.caller;return a},stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},disableClickPropagation(e){TL.DomEvent.addListener(e,TL.Draggable.START,TL.DomEvent.stopPropagation),TL.DomEvent.addListener(e,"click",TL.DomEvent.stopPropagation),TL.DomEvent.addListener(e,"dblclick",TL.DomEvent.stopPropagation)},preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stop(e){TL.DomEvent.preventDefault(e),TL.DomEvent.stopPropagation(e)},getWheelDelta(a){var t=0;return a.wheelDelta&&(t=a.wheelDelta/120),a.detail&&(t=-a.detail/3),t}},TL.StyleSheet=TL.Class.extend({includes:[TL.Events],_el:{},initialize(){this.style=document.createElement("style"),this.style.appendChild(document.createTextNode("")),document.head.appendChild(this.style),this.sheet=this.style.sheet},addRule(a,t,e){var i=0;e&&(i=e),"insertRule"in this.sheet?this.sheet.insertRule(a+"{"+t+"}",i):"addRule"in this.sheet&&this.sheet.addRule(a,t,i)},onLoaded(){this._state.loaded=!0,this.fire("loaded",this.data)}}),TL.Date=TL.Class.extend({initialize(a,t,e){"number"==typeof a?this.data={format:"yyyy mmmm",date_obj:new Date(a)}:Date==a.constructor?this.data={format:"yyyy mmmm",date_obj:a}:(this.data=JSON.parse(JSON.stringify(a)),this._createDateObj()),this._setFormat(t,e)},setDateFormat(e){this.data.format=e},getDisplayDate(a,o){if(this.data.display_date)return this.data.display_date;(a=a||TL.Language.fallback).constructor!=TL.Language&&(trace("First argument to getDisplayDate must be TL.Language"),a=TL.Language.fallback);var e=o||this.data.format;return a.formatDate(this.data.date_obj,e)},getMillisecond(){return this.getTime()},getTime(){return this.data.date_obj.getTime()},isBefore(e){if(!this.data.date_obj.constructor==e.data.date_obj.constructor)throw new TL.Error("date_compare_err");return"isBefore"in this.data.date_obj?this.data.date_obj.isBefore(e.data.date_obj):this.data.date_obj<e.data.date_obj},isAfter(e){if(!this.data.date_obj.constructor==e.data.date_obj.constructor)throw new TL.Error("date_compare_err");return"isAfter"in this.data.date_obj?this.data.date_obj.isAfter(e.data.date_obj):this.data.date_obj>e.data.date_obj},floor(a){for(var t=new Date(this.data.date_obj.getTime()),e=0;e<TL.Date.SCALES.length;e++)if(TL.Date.SCALES[e][2](t),TL.Date.SCALES[e][0]==a)return new TL.Date(t);throw new TL.Error("invalid_scale_err",a)},_getDateData(){var a={year:0,month:1,day:1,hour:0,minute:0,second:0,millisecond:0};TL.Util.mergeData(a,this.data);var t=TL.Date.DATE_PARTS;for(var e in t){if(!TL.Util.trim(a[t[e]]).match(/^-?\d*$/))throw new TL.Error("invalid_date_err",t[e]+" = '"+a[t[e]]+"'");var i=parseInt(a[t[e]]);isNaN(i)&&(i=4==e||5==e?1:0),a[t[e]]=i}return 0<a.month&&12>=a.month&&--a.month,a},_createDateObj(){var e=this._getDateData();this.data.date_obj=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond),this.data.date_obj.getFullYear()!=e.year&&this.data.date_obj.setFullYear(e.year)},findBestFormat(a){for(var o=TL.Date.DATE_PARTS,e=0;e<o.length;e++)if(this.data[o[e]])return a?a in TL.Date.BEST_DATEFORMATS||(a="short"):a="base",TL.Date.BEST_DATEFORMATS[a][o[e]];return""},_setFormat(a,t){a?this.data.format=a:this.data.format||(this.data.format=this.findBestFormat()),t?this.data.format_short=t:this.data.format_short||(this.data.format_short=this.findBestFormat(!0))}}),TL.Date.makeDate=function(a){var t=new TL.Date(a);return isNaN(t.getTime())?new TL.BigDate(a):t},TL.BigYear=TL.Class.extend({initialize(e){if(this.year=parseInt(e),isNaN(this.year))throw new TL.Error("invalid_year_err",e)},isBefore(e){return this.year<e.year},isAfter(e){return this.year>e.year},getTime(){return this.year}}),function(d){d.SCALES=[["millisecond",1,function(){}],["second",1e3,function(e){e.setMilliseconds(0)}],["minute",6e4,function(e){e.setSeconds(0)}],["hour",36e5,function(e){e.setMinutes(0)}],["day",864e5,function(e){e.setHours(0)}],["month",2592e6,function(e){e.setDate(1)}],["year",31536e6,function(e){e.setMonth(0)}],["decade",31536e7,function(a){var t=a.getFullYear();a.setFullYear(t-t%10)}],["century",31536e8,function(a){var t=a.getFullYear();a.setFullYear(t-t%100)}],["millennium",31536e9,function(a){var t=a.getFullYear();a.setFullYear(t-t%1e3)}]],d.DATE_PARTS=["millisecond","second","minute","hour","day","month","year"];var r=/^([\+-]?\d+?)(-\d{2}?)?(-\d{2}?)?$/;d.parseISODate=function(a){var t=new Date(a);if(isNaN(t))throw new TL.Error("invalid_date_err",a);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()}},d.parseDate=function(l){if(l.match(r)){var c=l.match(r).slice(1),e={year:c[0].replace("+","")};return c[1]&&(e.month=c[1].replace("-","")),c[2]&&(e.day=c[2].replace("-","")),e}if(l.match(/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/))return d.parseISODate(l);if(l.match(/^\-?\d+$/))return{year:l};var i={};if(l.match(/\d+\/\d+\/\d+/)){var _=l.match(/\d+\/\d+\/\d+/)[0];l=TL.Util.trim(l.replace(_,""));var m=_.split("/");i.month=m[0],i.day=m[1],i.year=m[2]}if(l.match(/\d+\/\d+/)&&(_=l.match(/\d+\/\d+/)[0],l=TL.Util.trim(l.replace(_,"")),m=_.split("/"),i.month=m[0],i.year=m[1]),l.match(":")){var p=l.split(":");i.hour=p[0],i.minute=p[1],p[2]&&(second_parts=p[2].split("."),i.second=second_parts[0],i.millisecond=second_parts[1])}return i},d.BEST_DATEFORMATS={base:{millisecond:"time_short",second:"time",minute:"time_no_seconds_small_date",hour:"time_no_seconds_small_date",day:"full",month:"month",year:"year",decade:"year",century:"year",millennium:"year",age:"fallback",epoch:"fallback",era:"fallback",eon:"fallback",eon2:"fallback"},short:{millisecond:"time_short",second:"time_short",minute:"time_no_seconds_short",hour:"time_no_minutes_short",day:"full_short",month:"month_short",year:"year",decade:"year",century:"year",millennium:"year",age:"fallback",epoch:"fallback",era:"fallback",eon:"fallback",eon2:"fallback"}}}(TL.Date),TL.BigDate=TL.Date.extend({initialize(a,t,e){TL.BigYear==a.constructor?this.data={date_obj:a}:(this.data=JSON.parse(JSON.stringify(a)),this._createDateObj()),this._setFormat(t,e)},_createDateObj(){var e=this._getDateData();this.data.date_obj=new TL.BigYear(e.year)},floor(a){for(var t=0;t<TL.BigDate.SCALES.length;t++)if(TL.BigDate.SCALES[t][0]==a){var o=TL.BigDate.SCALES[t][2](this.data.date_obj);return new TL.BigDate(o)}throw new TL.Error("invalid_scale_err",a)}}),function(){function e(a){return function(i){var t=i.getTime();return new TL.BigYear(Math.floor(t/a)*a)}}TL.BigDate.SCALES=[["year",1,new e(1)],["decade",10,new e(10)],["century",100,new e(100)],["millennium",1e3,new e(1e3)],["age",1e6,new e(1e6)],["epoch",1e7,new e(1e7)],["era",1e8,new e(1e8)],["eon",1e9,new e(1e9)]]}(),TL.DateUtil={get(e){return"string"==typeof e?document.getElementById(e):e},sortByDate(e,a){a=a||"start_date",e.sort(function(i,t){return i[a].isBefore(t[a])?-1:i[a].isAfter(t[a])?1:0})},parseTime(r){var l={hour:null,minute:null,second:null,millisecond:null},e=null,d=r.match(/(\s*[AaPp]\.?[Mm]\.?\s*)$/);d&&(e=TL.Util.trim(d[0]),r=TL.Util.trim(r.substring(0,r.lastIndexOf(e))));var c=[],_=r.match(/^\s*(\d{1,2})(\d{2})\s*$/);if(_?c=_.slice(1):1==(c=r.split(":")).length&&(c=r.split(".")),4<c.length)throw new TL.Error("invalid_separator_error");if(l.hour=parseInt(c[0]),e&&"p"==e.toLowerCase()[0]&&12!=l.hour?l.hour+=12:e&&"a"==e.toLowerCase()[0]&&12==l.hour&&(l.hour=0),isNaN(l.hour)||0>l.hour||23<l.hour)throw new TL.Error("invalid_hour_err",l.hour);if(1<c.length&&(l.minute=parseInt(c[1]),isNaN(l.minute)))throw new TL.Error("invalid_minute_err",l.minute);if(2<c.length){if(2<(c=c[2].split(/[\.,]/).concat(c.slice(3))).length)throw new TL.Error("invalid_second_fractional_err");if(l.second=parseInt(c[0]),isNaN(l.second))throw new TL.Error("invalid_second_err");if(2==c.length){var s=parseInt(c[1]);if(isNaN(s))throw new TL.Error("invalid_fractional_err");l.millisecond=100*s}}return l},SCALE_DATE_CLASSES:{human:TL.Date,cosmological:TL.BigDate}},TL.Draggable=TL.Class.extend({includes:TL.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize(a,t,e){this._el={drag:a,move:a},e&&(this._el.move=e),this.options={enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:!1,right:!1},momentum_multiplier:2e3,duration:1e3,ease:TL.Ease.easeInOutQuint},this.animator=null,this.dragevent=this.mousedrag,TL.Browser.touch&&(this.dragevent=this.touchdrag),this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1},TL.Util.mergeData(this.options,t)},enable(){this.data.pos.start=0,this._el.move.style.left=this.data.pos.start.x+"px",this._el.move.style.top=this.data.pos.start.y+"px",this._el.move.style.position="absolute"},disable(){TL.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum(){this.animator&&this.animator.stop()},updateConstraint(e){this.options.constraint=e},_onDragStart(e){TL.Browser.touch?e.originalEvent?(this.data.pagex.start=e.originalEvent.touches[0].screenX,this.data.pagey.start=e.originalEvent.touches[0].screenY):(this.data.pagex.start=e.targetTouches[0].screenX,this.data.pagey.start=e.targetTouches[0].screenY):(this.data.pagex.start=e.pageX,this.data.pagey.start=e.pageY),this.options.enable.x&&(this._el.move.style.left=this.data.pagex.start-this._el.move.offsetWidth/2+"px"),this.options.enable.y&&(this._el.move.style.top=this.data.pagey.start-this._el.move.offsetHeight/2+"px"),this.data.pos.start=TL.Dom.getPosition(this._el.drag),this.data.time.start=new Date().getTime(),this.fire("dragstart",this.data),TL.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd(){this.data.sliding=!1,TL.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this),this.fire("dragend",this.data),this._momentum()},_onDragMove(e){e.preventDefault(),this.data.sliding=!0,TL.Browser.touch?e.originalEvent?(this.data.pagex.end=e.originalEvent.touches[0].screenX,this.data.pagey.end=e.originalEvent.touches[0].screenY):(this.data.pagex.end=e.targetTouches[0].screenX,this.data.pagey.end=e.targetTouches[0].screenY):(this.data.pagex.end=e.pageX,this.data.pagey.end=e.pageY),this.data.pos.end=TL.Dom.getPosition(this._el.drag),this.data.new_pos.x=-(this.data.pagex.start-this.data.pagex.end-this.data.pos.start.x),this.data.new_pos.y=-(this.data.pagey.start-this.data.pagey.end-this.data.pos.start.y),this.options.enable.x&&(this._el.move.style.left=this.data.new_pos.x+"px"),this.options.enable.y&&(this._el.move.style.top=this.data.new_pos.y+"px"),this.fire("dragmove",this.data)},_momentum(){var a={x:0,y:0,time:0},t={x:0,y:0,time:0},e=!1;TL.Browser.touch,a.time=10*(new Date().getTime()-this.data.time.start),t.time=10*(new Date().getTime()-this.data.time.start),t.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start)),t.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start)),a.x=Math.round(t.x/t.time),a.y=Math.round(t.y/t.time),this.data.new_pos.x=Math.min(this.data.pos.end.x+a.x),this.data.new_pos.y=Math.min(this.data.pos.end.y+a.y),this.options.enable.x?0>this.data.new_pos.x&&(this.data.new_pos.x=0):this.data.new_pos.x=this.data.pos.start.x,this.options.enable.y?0>this.data.new_pos.y&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y,3e3>t.time&&(e=!0),1e4<Math.abs(t.x)&&(this.data.direction="left",0<t.x&&(this.data.direction="right")),1e4<Math.abs(t.y)&&(this.data.direction="up",0<t.y&&(this.data.direction="down")),this._animateMomentum(),e&&this.fire("swipe_"+this.data.direction,this.data)},_animateMomentum(){var a={x:this.data.new_pos.x,y:this.data.new_pos.y},t={duration:this.options.duration,easing:TL.Ease.easeOutStrong};this.options.enable.y&&((this.options.constraint.top||this.options.constraint.bottom)&&(a.y>this.options.constraint.bottom?a.y=this.options.constraint.bottom:a.y<this.options.constraint.top&&(a.y=this.options.constraint.top)),t.top=Math.floor(a.y)+"px"),this.options.enable.x&&((this.options.constraint.left||this.options.constraint.right)&&(a.x>this.options.constraint.left?a.x=this.options.constraint.left:a.x<this.options.constraint.right&&(a.x=this.options.constraint.right)),t.left=Math.floor(a.x)+"px"),this.animator=TL.Animate(this._el.move,t),this.fire("momentum",this.data)}}),TL.Swipable=TL.Class.extend({includes:TL.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize(a,t,e){this._el={drag:a,move:a},t&&(this._el.move=t),this.options={snap:!1,enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:0,right:!1},momentum_multiplier:2e3,duration:1e3,ease:TL.Ease.easeInOutQuint},this.animator=null,this.dragevent=this.mousedrag,TL.Browser.touch&&(this.dragevent=this.touchdrag),this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1},TL.Util.mergeData(this.options,e)},enable(){TL.DomEvent.addListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.up,this._onDragEnd,this),this.data.pos.start=0,this._el.move.style.left=this.data.pos.start.x+"px",this._el.move.style.top=this.data.pos.start.y+"px",this._el.move.style.position="absolute"},disable(){TL.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum(){this.animator&&this.animator.stop()},updateConstraint(e){this.options.constraint=e},_onDragStart(e){this.animator&&this.animator.stop(),TL.Browser.touch?e.originalEvent?(this.data.pagex.start=e.originalEvent.touches[0].screenX,this.data.pagey.start=e.originalEvent.touches[0].screenY):(this.data.pagex.start=e.targetTouches[0].screenX,this.data.pagey.start=e.targetTouches[0].screenY):(this.data.pagex.start=e.pageX,this.data.pagey.start=e.pageY),this.options.enable.x,this.options.enable.y,this.data.pos.start={x:this._el.move.offsetLeft,y:this._el.move.offsetTop},this.data.time.start=new Date().getTime(),this.fire("dragstart",this.data),TL.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd(){this.data.sliding=!1,TL.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this),this.fire("dragend",this.data),this._momentum()},_onDragMove(a){var t={x:0,y:0};this.data.sliding=!0,TL.Browser.touch?a.originalEvent?(this.data.pagex.end=a.originalEvent.touches[0].screenX,this.data.pagey.end=a.originalEvent.touches[0].screenY):(this.data.pagex.end=a.targetTouches[0].screenX,this.data.pagey.end=a.targetTouches[0].screenY):(this.data.pagex.end=a.pageX,this.data.pagey.end=a.pageY),t.x=this.data.pagex.start-this.data.pagex.end,t.y=this.data.pagey.start-this.data.pagey.end,this.data.pos.end={x:this._el.drag.offsetLeft,y:this._el.drag.offsetTop},this.data.new_pos.x=-(t.x-this.data.pos.start.x),this.data.new_pos.y=-(t.y-this.data.pos.start.y),this.options.enable.x&&Math.abs(t.x)>Math.abs(t.y)&&(a.preventDefault(),this._el.move.style.left=this.data.new_pos.x+"px"),this.options.enable.y&&Math.abs(t.y)>Math.abs(t.y)&&(a.preventDefault(),this._el.move.style.top=this.data.new_pos.y+"px"),this.fire("dragmove",this.data)},_momentum(){var a={x:0,y:0,time:0},t={x:0,y:0,time:0},e={x:!1,y:!1},i=!1;this.data.direction=null,a.time=10*(new Date().getTime()-this.data.time.start),t.time=10*(new Date().getTime()-this.data.time.start),t.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start)),t.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start)),a.x=Math.round(t.x/t.time),a.y=Math.round(t.y/t.time),this.data.new_pos.x=Math.min(this.data.new_pos.x+a.x),this.data.new_pos.y=Math.min(this.data.new_pos.y+a.y),this.options.enable.x?this.options.constraint.left&&this.data.new_pos.x>this.options.constraint.left&&(this.data.new_pos.x=this.options.constraint.left):this.data.new_pos.x=this.data.pos.start.x,this.options.enable.y?0>this.data.new_pos.y&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y,2e3>t.time&&(i=!0),this.options.enable.x&&this.options.enable.y?Math.abs(t.x)>Math.abs(t.y)?e.x=!0:e.y=!0:this.options.enable.x?Math.abs(t.x)>Math.abs(t.y)&&(e.x=!0):Math.abs(t.y)>Math.abs(t.x)&&(e.y=!0),e.x&&(Math.abs(t.x)>this._el.drag.offsetWidth/2&&(i=!0),1e4<Math.abs(t.x)&&(this.data.direction="left",0<t.x&&(this.data.direction="right"))),e.y&&(Math.abs(t.y)>this._el.drag.offsetHeight/2&&(i=!0),1e4<Math.abs(t.y)&&(this.data.direction="up",0<t.y&&(this.data.direction="down"))),1e3>t.time||this._animateMomentum(),i&&this.data.direction?this.fire("swipe_"+this.data.direction,this.data):this.data.direction?this.fire("swipe_nodirection",this.data):this.options.snap&&(this.animator.stop(),this.animator=TL.Animate(this._el.move,{top:this.data.pos.start.y,left:this.data.pos.start.x,duration:this.options.duration,easing:TL.Ease.easeOutStrong}))},_animateMomentum(){var a={x:this.data.new_pos.x,y:this.data.new_pos.y},t={duration:this.options.duration,easing:TL.Ease.easeOutStrong};this.options.enable.y&&((this.options.constraint.top||this.options.constraint.bottom)&&(a.y>this.options.constraint.bottom?a.y=this.options.constraint.bottom:a.y<this.options.constraint.top&&(a.y=this.options.constraint.top)),t.top=Math.floor(a.y)+"px"),this.options.enable.x&&(this.options.constraint.left&&a.x>=this.options.constraint.left&&(a.x=this.options.constraint.left),this.options.constraint.right&&a.x<this.options.constraint.right&&(a.x=this.options.constraint.right),t.left=Math.floor(a.x)+"px"),this.animator=TL.Animate(this._el.move,t),this.fire("momentum",this.data)}}),TL.MenuBar=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize(a,t,e){this._el={parent:{},container:{},button_backtostart:{},button_zoomin:{},button_zoomout:{},arrow:{},line:{},coverbar:{},grip:{}},this.collapsed=!1,this._el.container="object"==typeof a?a:TL.Dom.get(a),t&&(this._el.parent=t),this.options={width:600,height:600,duration:1e3,ease:TL.Ease.easeInOutQuint,menubar_default_y:0},this.animator={},TL.Util.mergeData(this.options,e),this._initLayout(),this._initEvents()},show(){this.options.duration},hide(){},toogleZoomIn(e){e?TL.DomUtil.removeClass(this._el.button_zoomin,"tl-menubar-button-inactive"):TL.DomUtil.addClass(this._el.button_zoomin,"tl-menubar-button-inactive")},toogleZoomOut(e){e?TL.DomUtil.removeClass(this._el.button_zoomout,"tl-menubar-button-inactive"):TL.DomUtil.addClass(this._el.button_zoomout,"tl-menubar-button-inactive")},setSticky(e){this.options.menubar_default_y=e},setColor(e){this._el.container.className=e?"tl-menubar tl-menubar-inverted":"tl-menubar"},updateDisplay(a,t,e,i){this._updateDisplay(a,t,e,i)},_onButtonZoomIn(e){this.fire("zoom_in",e)},_onButtonZoomOut(e){this.fire("zoom_out",e)},_onButtonBackToStart(e){this.fire("back_to_start",e)},_initLayout(){this._el.button_zoomin=TL.Dom.create("span","tl-menubar-button",this._el.container),this._el.button_zoomout=TL.Dom.create("span","tl-menubar-button",this._el.container),this._el.button_backtostart=TL.Dom.create("span","tl-menubar-button",this._el.container),TL.Browser.mobile&&this._el.container.setAttribute("ontouchstart"," "),this._el.button_backtostart.innerHTML="<span class='tl-icon-goback'></span>",this._el.button_zoomin.innerHTML="<span class='tl-icon-zoom-in'></span>",this._el.button_zoomout.innerHTML="<span class='tl-icon-zoom-out'></span>"},_initEvents(){TL.DomEvent.addListener(this._el.button_backtostart,"click",this._onButtonBackToStart,this),TL.DomEvent.addListener(this._el.button_zoomin,"click",this._onButtonZoomIn,this),TL.DomEvent.addListener(this._el.button_zoomout,"click",this._onButtonZoomOut,this)},_updateDisplay(a,t){a&&(this.options.width=a),t&&(this.options.height=t)}}),TL.Message=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize(a,t,e){this._el={parent:{},container:{},message_container:{},loading_icon:{},message:{}},this.options={width:600,height:600,message_class:"tl-message",message_icon_class:"tl-loading-icon"},this._add_to_container=e||{},TL.Util.mergeData(this.data,a),TL.Util.mergeData(this.options,t),this._el.container=TL.Dom.create("div",this.options.message_class),e&&(e.appendChild(this._el.container),this._el.parent=e),this.animator={},this._initLayout(),this._initEvents()},updateMessage(e){this._updateMessage(e)},updateDisplay(a,t){this._updateDisplay(a,t)},_updateMessage(e){this._el.message.innerHTML=e||this._("loading"),!this._el.parent.atrributes&&this._add_to_container.attributes&&(this._add_to_container.appendChild(this._el.container),this._el.parent=this._add_to_container)},_onMouseClick(){this.fire("clicked",this.options)},_onRemove(){this._el.parent={}},_initLayout(){this._el.message_container=TL.Dom.create("div","tl-message-container",this._el.container),this._el.loading_icon=TL.Dom.create("div",this.options.message_icon_class,this._el.message_container),this._el.message=TL.Dom.create("div","tl-message-content",this._el.message_container),this._updateMessage()},_initEvents(){TL.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this),TL.DomEvent.addListener(this,"removed",this._onRemove,this)},_updateDisplay(){}}),TL.MediaType=function(a,t){var e=[{type:"image",name:"Image",match_str:/(jpg|jpeg|png|gif|svg)(\?.*)?$/i,cls:TL.Media.Image},{type:"imageblank",name:"Imageblank",match_str:"",cls:TL.Media.Image}];if(t){if(a instanceof Array)return!1;for(var i=0;i<e.length;i++)switch(e[i].type){case"image":if(a.url.match(e[i].match_str))return e[i];}}else for(i=0;i<e.length;i++){if(a instanceof Array)return{type:"slider",cls:TL.Media.Slider};if(a.url.match(e[i].match_str))return e[i]}return!1},TL.Media=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],_el:{},initialize(a,t,e){this._el={container:{},content_container:{},content:{},content_item:{},content_link:{},caption:null,credit:null,parent:{},link:null},this.player=null,this.timer=null,this.load_timer=null,this.message=null,this.media_id=null,this._state={loaded:!1,show_meta:!1,media_loaded:!1},this.data={unique_id:null,url:null,credit:null,caption:null,credit_alternate:null,caption_alternate:null,link:null,link_target:null},this.options={api_key_embedly:"",credit_height:0,caption_height:0,background:0},this.animator={},TL.Util.mergeData(this.options,t),TL.Util.mergeData(this.data,a),this.options.background||(this._el.container=TL.Dom.create("div","tl-media"),this.data.unique_id&&(this._el.container.id=this.data.unique_id),this._initLayout(),e&&(e.appendChild(this._el.container),this._el.parent=e))},loadMedia(){var e=this;if(!this._state.loaded)try{this.load_timer=setTimeout(function(){e._loadMedia(),e._updateDisplay()},1200)}catch(e){trace("Error loading media for ",this._media),trace(e)}},updateMediaDisplay(e){this._state.loaded&&!this.options.background&&(this._el.content_item.style.maxHeight=TL.Browser.mobile?this.options.height/2+"px":this.options.height-this.options.credit_height-this.options.caption_height-30+"px",this._el.container.style.maxWidth=this.options.width+"px",TL.Browser.firefox&&(this._el.content_item.offsetWidth,this._el.content_item.offsetHeight),this._updateMediaDisplay(e),this._state.media_loaded&&(this._el.credit&&(this._el.credit.style.width=this._el.content_item.offsetWidth+"px"),this._el.caption&&(this._el.caption.style.width=this._el.content_item.offsetWidth+"px")))},_loadMedia(){this.onLoaded()},_updateMediaDisplay(){TL.Browser.firefox&&(this._el.content_item.style.maxWidth=this.options.width+"px",this._el.content_item.style.width="auto")},_getMeta(){},_getImageURL(){return""},show(){},hide(){},addTo(e){e.appendChild(this._el.container),this.onAdd()},removeFrom(e){e.removeChild(this._el.container),this.onRemove()},getImageURL(a,t){return this._getImageURL(a,t)},updateDisplay(a,t,e){this._updateDisplay(a,t,e)},stopMedia(){this._stopMedia()},loadErrorDisplay(e){try{this._el.content.removeChild(this._el.content_item)}catch(e){}this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-loaderror",this._el.content),this._el.content_item.innerHTML="<div class='tl-icon-"+this.options.media_type+"'></div><p>"+e+"</p>",this.onLoaded(!0)},onLoaded(e){this._state.loaded=!0,this.fire("loaded",this.data),e||this.options.background||this.showMeta(),this.updateDisplay()},onMediaLoaded(){this._state.media_loaded=!0,this.fire("media_loaded",this.data),this._el.credit&&(this._el.credit.style.width=this._el.content_item.offsetWidth+"px"),this._el.caption&&(this._el.caption.style.width=this._el.content_item.offsetWidth+"px")},showMeta(){this._state.show_meta=!0,this.data.credit&&""!=this.data.credit&&(this._el.credit=TL.Dom.create("div","tl-credit",this._el.content_container),this._el.credit.innerHTML=1==this.options.autolink?TL.Util.linkify(this.data.credit):this.data.credit,this.options.credit_height=this._el.credit.offsetHeight),this.data.caption&&""!=this.data.caption&&(this._el.caption=TL.Dom.create("div","tl-caption",this._el.content_container),this._el.caption.innerHTML=1==this.options.autolink?TL.Util.linkify(this.data.caption):this.data.caption,this.options.caption_height=this._el.caption.offsetHeight),this.data.caption&&this.data.credit||this.getMeta()},getMeta(){this._getMeta()},updateMeta(){!this.data.credit&&this.data.credit_alternate&&(this._el.credit=TL.Dom.create("div","tl-credit",this._el.content_container),this._el.credit.innerHTML=this.data.credit_alternate,this.options.credit_height=this._el.credit.offsetHeight),!this.data.caption&&this.data.caption_alternate&&(this._el.caption=TL.Dom.create("div","tl-caption",this._el.content_container),this._el.caption.innerHTML=this.data.caption_alternate,this.options.caption_height=this._el.caption.offsetHeight),this.updateDisplay()},onAdd(){this.fire("added",this.data)},onRemove(){this.fire("removed",this.data)},_initLayout(){this._el.content_container=TL.Dom.create("div","tl-media-content-container",this._el.container),this.data.link&&""!=this.data.link?(this._el.link=TL.Dom.create("a","tl-media-link",this._el.content_container),this._el.link.href=this.data.link,this._el.link.target=this.data.link_target&&""!=this.data.link_target?this.data.link_target:"_blank",this._el.content=TL.Dom.create("div","tl-media-content",this._el.link)):this._el.content=TL.Dom.create("div","tl-media-content",this._el.content_container)},_updateDisplay(a,t,e){a&&(this.options.width=a),t&&(this.options.height=t),e&&(this.options.layout=e),this._el.credit&&(this.options.credit_height=this._el.credit.offsetHeight),this._el.caption&&(this.options.caption_height=this._el.caption.offsetHeight+5),this.updateMediaDisplay(this.options.layout)},_stopMedia(){}}),TL.Media.Image=TL.Media.extend({includes:[TL.Events],_loadMedia(){this.options.background||this.createMedia(),this.onLoaded()},createMedia(){var a=this,e="tl-media-item tl-media-image tl-media-shadow";(this.data.url.match(/.png(\?.*)?$/)||this.data.url.match(/.svg(\?.*)?$/))&&(e="tl-media-item tl-media-image"),this.data.link?(this._el.content_link=TL.Dom.create("a","",this._el.content),this._el.content_link.href=this.data.link,this._el.content_link.target="_blank",this._el.content_item=TL.Dom.create("img",e,this._el.content_link)):this._el.content_item=TL.Dom.create("img",e,this._el.content),this.data.alt?this._el.content_item.alt=this.data.alt:this.data.caption&&(this._el.content_item.alt=TL.Util.unhtmlify(this.data.caption)),this.data.title?this._el.content_item.title=this.data.title:this.data.caption&&(this._el.content_item.title=TL.Util.unhtmlify(this.data.caption)),this._el.content_item.addEventListener("load",function(){a.onMediaLoaded()}),this._el.content_item.src=this.getImageURL()},getImageURL(){return TL.Util.transformImageURL(this.data.url)},_updateMediaDisplay(){TL.Browser.firefox&&(this._el.content_item.style.width="auto")}}),TL.Media.Slider=TL.Media.extend({includes:[TL.Events],_loadMedia(){this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image",this._el.content),this._el.content_item.src=this.data.url,this.onLoaded()}}),TL.Media.Text=TL.Class.extend({includes:[TL.Events],_el:{container:{},content_container:{},content:{},headline:{},date:{}},data:{unique_id:"",headline:"headline",text:"text"},options:{title:!1},initialize(a,t,e){TL.Util.setData(this,a),TL.Util.mergeData(this.options,t),this._el.container=TL.Dom.create("div","tl-text"),this._el.container.id=this.data.unique_id,this._initLayout(),e&&e.appendChild(this._el.container)},show(){},hide(){},addTo(e){e.appendChild(this._el.container)},removeFrom(e){e.removeChild(this._el.container)},headlineHeight(){return this._el.headline.offsetHeight+40},addDateText(e){this._el.date.innerHTML=e},onLoaded(){this.fire("loaded",this.data)},onAdd(){this.fire("added",this.data)},onRemove(){this.fire("removed",this.data)},_initLayout(){if(this._el.content_container=TL.Dom.create("div","tl-text-content-container",this._el.container),this._el.date=TL.Dom.create("h3","tl-headline-date",this._el.content_container),""!=this.data.headline){var a="tl-headline";this.options.title&&(a="tl-headline tl-headline-title"),this._el.headline=TL.Dom.create("h2",a,this._el.content_container),this._el.headline.innerHTML=this.data.headline}if(""!=this.data.text){var i="";i+=TL.Util.htmlify(1==this.options.autolink?TL.Util.linkify(this.data.text):this.data.text),trace(this.data.text),this._el.content=TL.Dom.create("div","tl-text-content",this._el.content_container),this._el.content.innerHTML=i,trace(i),trace(this._el.content)}this.onLoaded()}}),TL.Slide=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize(a,t,e){this._el={container:{},scroll_container:{},background:{},content_container:{},content:{}},this._media=null,this._mediaclass={},this._text={},this._background_media=null,this._state={loaded:!1},this.has={headline:!1,text:!1,media:!1,title:!1,background:{image:!1,color:!1,color_value:""}},this.has.title=e,this.data={unique_id:null,background:null,start_date:null,end_date:null,location:null,text:null,media:null,autolink:!0},this.options={duration:1e3,slide_padding_lr:40,ease:TL.Ease.easeInSpline,width:600,height:600,skinny_size:650,media_name:""},this.active=!1,this.animator={},TL.Util.mergeData(this.options,t),TL.Util.mergeData(this.data,a),this._initLayout(),this._initEvents()},show(){this.animator=TL.Animate(this._el.slider_container,{left:-this._el.container.offsetWidth*n+"px",duration:this.options.duration,easing:this.options.ease})},hide(){},setActive(e){this.active=e,this.active?(this.data.background&&this.fire("background_change",this.has.background),this.loadMedia()):this.stopMedia()},addTo(e){e.appendChild(this._el.container)},removeFrom(e){e.removeChild(this._el.container)},updateDisplay(a,t,e){this._updateDisplay(a,t,e)},loadMedia(){var e=this;this._media&&!this._state.loaded&&(this._media.loadMedia(),this._state.loaded=!0),this._background_media&&!this._background_media._state.loaded&&(this._background_media.on("loaded",function(){e._updateBackgroundDisplay()}),this._background_media.loadMedia())},stopMedia(){this._media&&this._state.loaded&&this._media.stopMedia()},getBackground(){return this.has.background},scrollToTop(){this._el.container.scrollTop=0},getFormattedDate(){if(0<TL.Util.trim(this.data.display_date).length)return this.data.display_date;var e="";return this.has.title||(this.data.end_date&&(e=" &mdash; "+this.data.end_date.getDisplayDate(this.getLanguage())),this.data.start_date&&(e=this.data.start_date.getDisplayDate(this.getLanguage())+e)),e},_initLayout(){if(this._el.container=TL.Dom.create("div","tl-slide"),this.has.title&&(this._el.container.className="tl-slide tl-slide-titleslide"),this.data.unique_id&&(this._el.container.id=this.data.unique_id),this._el.scroll_container=TL.Dom.create("div","tl-slide-scrollable-container",this._el.container),this._el.content_container=TL.Dom.create("div","tl-slide-content-container",this._el.scroll_container),this._el.content=TL.Dom.create("div","tl-slide-content",this._el.content_container),this._el.background=TL.Dom.create("div","tl-slide-background",this._el.container),this.data.background){if(this.data.background.url){var e=TL.MediaType(this.data.background,!0);e&&(this._background_media=new e.cls(this.data.background,{background:1}),this.has.background.image=!0,this._el.container.className+=" tl-full-image-background",this.has.background.color_value="#000",this._el.background.style.display="block")}this.data.background.color&&(this.has.background.color=!0,this._el.container.className+=" tl-full-color-background",this.has.background.color_value=this.data.background.color),this.data.background.text_background&&(this._el.container.className+=" tl-text-background")}this.data.media&&this.data.media.url&&""!=this.data.media.url&&(this.has.media=!0),this.data.text&&this.data.text.text&&(this.has.text=!0),this.data.text&&this.data.text.headline&&(this.has.headline=!0),this.has.media&&(this.data.media.mediatype=TL.MediaType(this.data.media),this.options.media_name=this.data.media.mediatype.name,this.options.media_type=this.data.media.mediatype.type,this.options.autolink=this.data.autolink,this._media=new this.data.media.mediatype.cls(this.data.media,this.options)),(this.has.text||this.has.headline)&&(this._text=new TL.Media.Text(this.data.text,{title:this.has.title,language:this.options.language,autolink:this.data.autolink}),this._text.addDateText(this.getFormattedDate())),this.has.text||this.has.headline||!this.has.media?this.has.headline&&this.has.media&&!this.has.text?(TL.DomUtil.addClass(this._el.container,"tl-slide-media-only"),this._text.addTo(this._el.content),this._media.addTo(this._el.content)):this.has.text&&this.has.media?(this._media.addTo(this._el.content),this._text.addTo(this._el.content)):(this.has.text||this.has.headline)&&(TL.DomUtil.addClass(this._el.container,"tl-slide-text-only"),this._text.addTo(this._el.content)):(TL.DomUtil.addClass(this._el.container,"tl-slide-media-only"),this._media.addTo(this._el.content)),this.onLoaded()},_initEvents(){},_updateDisplay(o,t,e){var i,r=this.options.slide_padding_lr,l=this.options.slide_padding_lr;this.options.width=o||this._el.container.offsetWidth,i=this.options.width-2*this.options.slide_padding_lr,TL.Browser.mobile&&this.options.width<=this.options.skinny_size?(l=r=0,i=this.options.width):"landscape"==e||this.options.width<=this.options.skinny_size&&(l=r=50,i=this.options.width-r-l),this._el.content.style.paddingLeft=r+"px",this._el.content.style.paddingRight=l+"px",this._el.content.style.width=i+"px",this.options.height=t||this._el.container.offsetHeight,this._media&&(!this.has.text&&this.has.headline?this._media.updateDisplay(i,this.options.height-this._text.headlineHeight(),e):this.has.text||this.has.headline?this.options.width<=this.options.skinny_size?this._media.updateDisplay(i,this.options.height,e):this._media.updateDisplay(i/2,this.options.height,e):this._media.updateDisplay(i,this.options.height,e)),this._updateBackgroundDisplay()},_updateBackgroundDisplay(){this._background_media&&this._background_media._state.loaded&&(this._el.background.style.backgroundImage="url('"+this._background_media.getImageURL(this.options.width,this.options.height)+"')")}}),TL.SlideNav=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize(a,t,e){this._el={container:{},content_container:{},icon:{},title:{},description:{}},this.mediatype={},this.data={title:"Navigation",description:"Description",date:"Date"},this.options={direction:"previous"},this.animator=null,TL.Util.mergeData(this.options,t),TL.Util.mergeData(this.data,a),this._el.container=TL.Dom.create("div","tl-slidenav tl-slidenav-"+this.options.direction),TL.Browser.mobile&&this._el.container.setAttribute("ontouchstart"," "),this._initLayout(),this._initEvents(),e&&e.appendChild(this._el.container)},update(a){var t={title:"",description:"",date:a.getFormattedDate()};a.data.text&&a.data.text.headline&&(t.title=a.data.text.headline),this._update(t)},setColor(e){this._el.content_container.className=e?"tl-slidenav-content-container tl-slidenav-inverted":"tl-slidenav-content-container"},_onMouseClick(){this.fire("clicked",this.options)},_update(e){this.data=TL.Util.mergeData(this.data,e),this._el.title.innerHTML=TL.Util.unlinkify(this.data.title),this._el.description.innerHTML=TL.Util.unlinkify(this.data.date)},_initLayout(){this._el.content_container=TL.Dom.create("div","tl-slidenav-content-container",this._el.container),this._el.icon=TL.Dom.create("div","tl-slidenav-icon",this._el.content_container),this._el.title=TL.Dom.create("div","tl-slidenav-title",this._el.content_container),this._el.description=TL.Dom.create("div","tl-slidenav-description",this._el.content_container),this._el.icon.innerHTML="&nbsp;",this._update()},_initEvents(){TL.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)}}),TL.StorySlider=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],initialize(a,t,e,i){this._el={container:{},background:{},slider_container_mask:{},slider_container:{},slider_item_container:{}},this._nav={},this._nav.previous={},this._nav.next={},this.slide_spacing=0,this._slides=[],this._swipable,this.preloadTimer,this._message,this.current_id="",this.data={},this.options={id:"",layout:"portrait",width:600,height:600,default_bg_color:{r:255,g:255,b:255},slide_padding_lr:40,start_at_slide:1,slide_default_fade:"0%",duration:1e3,ease:TL.Ease.easeInOutQuint,dragging:!0,trackResize:!0},"object"==typeof a?(this._el.container=a,this.options.id=TL.Util.unique_ID(6,"tl")):(this.options.id=a,this._el.container=TL.Dom.get(a)),this._el.container.id||(this._el.container.id=this.options.id),this.animator=null,TL.Util.mergeData(this.options,e),TL.Util.mergeData(this.data,t),i&&this.init()},init(){this._initLayout(),this._initEvents(),this._initData(),this._updateDisplay(),this.goTo(this.options.start_at_slide),this._onLoaded()},_addSlide(e){e.addTo(this._el.slider_item_container),e.on("added",this._onSlideAdded,this),e.on("background_change",this._onBackgroundChange,this)},_createSlide(a,t,e){var i=new TL.Slide(a,this.options,t);this._addSlide(i),0>e?this._slides.push(i):this._slides.splice(e,0,i)},_createSlides(a){for(var t=0;t<a.length;t++)""==a[t].unique_id&&(a[t].unique_id=TL.Util.unique_ID(6,"tl-slide")),this._createSlide(a[t],!1,-1)},_removeSlide(e){e.removeFrom(this._el.slider_item_container),e.off("added",this._onSlideRemoved,this),e.off("background_change",this._onBackgroundChange)},_destroySlide(e){this._removeSlide(this._slides[e]),this._slides.splice(e,1)},_findSlideIndex(a){var t=a;return("string"==typeof a||a instanceof String)&&(t=TL.Util.findArrayNumberByUniqueID(a,this._slides,"unique_id")),t},updateDisplay(a,t,e,i){this._updateDisplay(a,t,e,i)},createSlide(a,t){this._createSlide(a,!1,t)},createSlides(e){this._createSlides(e)},destroySlide(e){this._destroySlide(e)},destroySlideId(e){this.destroySlide(this._findSlideIndex(e))},goTo(o,s,e){o=parseInt(o),isNaN(o)&&(o=0);var i=this;this.changeBackground({color_value:"",image:!1}),this.preloadTimer&&clearTimeout(this.preloadTimer);for(var r=0;r<this._slides.length;r++)this._slides[r].setActive(!1);o<this._slides.length&&0<=o&&(this.current_id=this._slides[o].data.unique_id,this.animator&&this.animator.stop(),this._swipable&&this._swipable.stopMomentum(),s?(this._el.slider_container.style.left=-this.slide_spacing*o+"px",this._onSlideChange(e)):this.animator=TL.Animate(this._el.slider_container,{left:-this.slide_spacing*o+"px",duration:this.options.duration,easing:this.options.ease,complete:this._onSlideChange(e)}),this._slides[o].setActive(!0),this._slides[o+1]?(this.showNav(this._nav.next,!0),this._nav.next.update(this._slides[o+1])):this.showNav(this._nav.next,!1),this._slides[o-1]?(this.showNav(this._nav.previous,!0),this._nav.previous.update(this._slides[o-1])):this.showNav(this._nav.previous,!1),this.preloadTimer=setTimeout(function(){i.preloadSlides(o)},this.options.duration))},goToId(a,t,e){this.goTo(this._findSlideIndex(a),t,e)},preloadSlides(e){this._slides[e+1]&&(this._slides[e+1].loadMedia(),this._slides[e+1].scrollToTop()),this._slides[e+2]&&(this._slides[e+2].loadMedia(),this._slides[e+2].scrollToTop()),this._slides[e-1]&&(this._slides[e-1].loadMedia(),this._slides[e-1].scrollToTop()),this._slides[e-2]&&(this._slides[e-2].loadMedia(),this._slides[e-2].scrollToTop())},next(){var e=this._findSlideIndex(this.current_id);e+1<this._slides.length?this.goTo(e+1):this.goTo(e)},previous(){var e=this._findSlideIndex(this.current_id);0<=e-1?this.goTo(e-1):this.goTo(e)},showNav(a,t){500>=this.options.width&&TL.Browser.mobile||(t?a.show():a.hide())},changeBackground(a){var t={r:256,g:256,b:256};a.color_value&&""!=a.color_value?(t=TL.Util.hexToRgb(a.color_value))||(trace("Invalid color value "+a.color_value),t=this.options.default_bg_color):(t=this.options.default_bg_color,a.color_value="rgb("+t.r+" , "+t.g+", "+t.b+")"),t.r,t.g,t.b,this._el.background.style.backgroundImage="none",this._el.background.style.backgroundColor=a.color_value?a.color_value:"transparent",255>t.r||255>t.g||255>t.b||a.image?(this._nav.next.setColor(!0),this._nav.previous.setColor(!0)):(this._nav.next.setColor(!1),this._nav.previous.setColor(!1))},_updateDisplay(r,t,e,i){var l,d;d=void 0===i?this.options.layout:i,this.options.layout=d,this.slide_spacing=2*this.options.width,this.options.width=r||this._el.container.offsetWidth,this.options.height=t||this._el.container.offsetHeight,l=this.options.height/2,this._nav.next.setPosition({top:l}),this._nav.previous.setPosition({top:l});for(var c=0;c<this._slides.length;c++)this._slides[c].updateDisplay(this.options.width,this.options.height,d),this._slides[c].setPosition({left:this.slide_spacing*c,top:0});this.goToId(this.current_id,!0,!0)},_updateDrawSlides(){for(var a=this.options.layout,t=0;t<this._slides.length;t++)this._slides[t].updateDisplay(this.options.width,this.options.height,a),this._slides[t].setPosition({left:this.slide_spacing*t,top:0});this.goToId(this.current_id,!0,!1)},_initLayout(){TL.DomUtil.addClass(this._el.container,"tl-storyslider"),this._el.slider_container_mask=TL.Dom.create("div","tl-slider-container-mask",this._el.container),this._el.background=TL.Dom.create("div","tl-slider-background tl-animate",this._el.container),this._el.slider_container=TL.Dom.create("div","tl-slider-container tlanimate",this._el.slider_container_mask),this._el.slider_item_container=TL.Dom.create("div","tl-slider-item-container",this._el.slider_container),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this._nav.previous=new TL.SlideNav({title:"Previous",description:"description"},{direction:"previous"}),this._nav.next=new TL.SlideNav({title:"Next",description:"description"},{direction:"next"}),this._nav.next.addTo(this._el.container),this._nav.previous.addTo(this._el.container),this._el.slider_container.style.left="0px",TL.Browser.touch&&(this._swipable=new TL.Swipable(this._el.slider_container_mask,this._el.slider_container,{enable:{x:!0,y:!1},snap:!0}),this._swipable.enable(),this._message=new TL.Message({},{message_class:"tl-message-full",message_icon_class:"tl-icon-swipe-left"}),this._message.updateMessage(this._("swipe_to_navigate")),this._message.addTo(this._el.container))},_initEvents(){this._nav.next.on("clicked",this._onNavigation,this),this._nav.previous.on("clicked",this._onNavigation,this),this._message&&this._message.on("clicked",this._onMessageClick,this),this._swipable&&(this._swipable.on("swipe_left",this._onNavigation,this),this._swipable.on("swipe_right",this._onNavigation,this),this._swipable.on("swipe_nodirection",this._onSwipeNoDirection,this))},_initData(){this.data.title&&this._createSlide(this.data.title,!0,-1),this._createSlides(this.data.events)},_onBackgroundChange(a){var t=this._findSlideIndex(this.current_id),e=this._slides[t].getBackground();this.changeBackground(a),this.fire("colorchange",e)},_onMessageClick(){this._message.hide()},_onSwipeNoDirection(){this.goToId(this.current_id)},_onNavigation(e){"next"==e.direction||"left"==e.direction?this.next():"previous"!=e.direction&&"right"!=e.direction||this.previous(),this.fire("nav_"+e.direction,this.data)},_onSlideAdded(){trace("slideadded"),this.fire("slideAdded",this.data)},_onSlideRemoved(){this.fire("slideRemoved",this.data)},_onSlideChange(e){e||this.fire("change",{unique_id:this.current_id})},_onMouseClick(){},_fireMouseEvent(a){if(this._loaded){var t=a.type;t="mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t,this.hasEventListeners(t)&&("contextmenu"===t&&TL.DomEvent.preventDefault(a),this.fire(t,{latlng:"something",layerPoint:"something else"}))}},_onLoaded(){this.fire("loaded",this.data)}}),TL.TimeNav=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize(a,t,e,i){this._el={parent:{},container:{},slider:{},slider_background:{},line:{},marker_container_mask:{},marker_container:{},marker_item_container:{},timeaxis:{},timeaxis_background:{},attribution:{}},this.collapsed=!1,this._el.container="object"==typeof a?a:TL.Dom.get(a),this.config=t,this.options={width:600,height:600,duration:1e3,ease:TL.Ease.easeInOutQuint,has_groups:!1,optimal_tick_width:50,scale_factor:2,marker_padding:5,timenav_height_min:150,marker_height_min:30,marker_width_min:100,zoom_sequence:[.5,1,2,3,5,8,13,21,34,55,89]},this.animator=null,this.ready=!1,this._markers=[],this._eras=[],this.has_eras=!1,this._groups=[],this._calculated_row_height=100,this.current_id="",this.timescale={},this.timeaxis={},this.axishelper={},this.max_rows=6,this.animate_css=!1,this._swipable,TL.Util.mergeData(this.options,e),i&&this.init()},init(){this._initLayout(),this._initEvents(),this._initData(),this._updateDisplay(),this._onLoaded()},positionMarkers(){this._positionMarkers()},updateDisplay(a,t,e,i){this._updateDisplay(a,t,e,i)},_getTimeScale(){var a=0;try{a=parseInt(this.options.marker_height_min)}catch(e){trace("Invalid value for marker_height_min option."),a=30}return 0==a&&(trace("marker_height_min option must not be zero."),a=30),this.max_rows=Math.round((this.options.height-this._el.timeaxis_background.offsetHeight-this.options.marker_padding)/a),1>this.max_rows&&(this.max_rows=1),new TL.TimeScale(this.config,{display_width:this._el.container.offsetWidth,screen_multiplier:this.options.scale_factor,max_rows:this.max_rows})},_updateTimeScale(e){this.options.scale_factor=e,this._updateDrawTimeline()},zoomIn(){var e=TL.Util.findNextGreater(this.options.zoom_sequence,this.options.scale_factor);this.setZoomFactor(e)},zoomOut(){var e=TL.Util.findNextLesser(this.options.zoom_sequence,this.options.scale_factor);this.setZoomFactor(e)},setZoom(a){var t=this.options.zoom_sequence[a];"number"==typeof t?this.setZoomFactor(t):console.warn("Invalid zoom level. Please use an index number between 0 and "+(this.options.zoom_sequence.length-1))},setZoomFactor(e){e<=this.options.zoom_sequence[0]?this.fire("zoomtoggle",{zoom:"out",show:!1}):this.fire("zoomtoggle",{zoom:"out",show:!0}),e>=this.options.zoom_sequence[this.options.zoom_sequence.length-1]?this.fire("zoomtoggle",{zoom:"in",show:!1}):this.fire("zoomtoggle",{zoom:"in",show:!0}),0==e&&(console.warn("Zoom factor must be greater than zero. Using 0.1"),e=.1),this.options.scale_factor=e,this.goToId(this.current_id,!this._updateDrawTimeline(!0),!0)},_addMarker(e){e.addTo(this._el.marker_item_container),e.on("markerclick",this._onMarkerClick,this),e.on("added",this._onMarkerAdded,this)},_createMarker(a,t){var e=new TL.TimeMarker(a,this.options);this._addMarker(e),0>t?this._markers.push(e):this._markers.splice(t,0,e)},_createMarkers(a){for(var t=0;t<a.length;t++)this._createMarker(a[t],-1)},_removeMarker(e){e.removeFrom(this._el.marker_item_container)},_destroyMarker(e){this._removeMarker(this._markers[e]),this._markers.splice(e,1)},_positionMarkers(a){for(var t,o=0;o<this._markers.length;o++)t=this.timescale.getPositionInfo(o),a?this._markers[o].setClass("tl-timemarker tl-timemarker-fast"):this._markers[o].setClass("tl-timemarker"),this._markers[o].setPosition({left:t.start}),this._markers[o].setWidth(t.width)},_calculateMarkerHeight(e){return e/this.timescale.getNumberOfRows()-this.options.marker_padding},_calculateRowHeight(e){return e/this.timescale.getNumberOfRows()},_calculateAvailableHeight(){return this.options.height-this._el.timeaxis_background.offsetHeight-this.options.marker_padding},_calculateMinimumTimeNavHeight(){return this.timescale.getNumberOfRows()*this.options.marker_height_min+this._el.timeaxis_background.offsetHeight+this.options.marker_padding},getMinimumHeight(){return this._calculateMinimumTimeNavHeight()},_assignRowsToMarkers(){var o=this._calculateAvailableHeight(),t=this._calculateMarkerHeight(o);this._calculated_row_height=this._calculateRowHeight(o);for(var e=0;e<this._markers.length;e++){this._markers[e].setHeight(t);var r=this.timescale.getPositionInfo(e).row,l=Math.floor(r*(t+this.options.marker_padding))+this.options.marker_padding,a=o-l+this.options.marker_padding;this._markers[e].setRowPosition(l,a)}},_resetMarkersActive(){for(var e=0;e<this._markers.length;e++)this._markers[e].setActive(!1)},_findMarkerIndex(a){var t=-1;return("string"==typeof a||a instanceof String)&&(t=TL.Util.findArrayNumberByUniqueID(a,this._markers,"unique_id",t)),t},createMarker(a,t){this._createMarker(a,t)},createMarkers(e){this._createMarkers(e)},destroyMarker(e){this._destroyMarker(e)},destroyMarkerId(e){this.destroyMarker(this._findMarkerIndex(e))},goTo(o,t,e){var i=this.options.ease,r=this.options.duration,a=0>o?0:o;this._resetMarkersActive(),0<=o&&o<this._markers.length&&this._markers[o].setActive(!0),this.animator&&this.animator.stop(),t?(this._el.slider.className="tl-timenav-slider",this._el.slider.style.left=-this._markers[a].getLeft()+this.options.width/2+"px"):e?(this._el.slider.className="tl-timenav-slider tl-timenav-slider-animate",this.animate_css=!0,this._el.slider.style.left=-this._markers[a].getLeft()+this.options.width/2+"px"):(this._el.slider.className="tl-timenav-slider",this.animator=TL.Animate(this._el.slider,{left:-this._markers[a].getLeft()+this.options.width/2+"px",duration:r,easing:i})),this.current_id=0<=o&&o<this._markers.length?this._markers[o].data.unique_id:""},goToId(a,t,e){this.goTo(this._findMarkerIndex(a),t,e)},_onLoaded(){this.ready=!0,this.fire("loaded",this.config)},_onMarkerAdded(){this.fire("dateAdded",this.config)},_onEraAdded(){this.fire("eraAdded",this.config)},_onMarkerRemoved(){this.fire("dateRemoved",this.config)},_onMarkerClick(e){this.goToId(e.unique_id),this.fire("change",{unique_id:e.unique_id})},_onMouseScroll(a){var o=0,s=0,r={right:-(this.timescale.getPixelWidth()-this.options.width/2),left:this.options.width/2};(a=a||window.event).originalEvent&&(a=a.originalEvent),void 0!==a.wheelDeltaX&&(o=a.wheelDeltaY/6,o=Math.abs(a.wheelDeltaX)>Math.abs(a.wheelDeltaY)?a.wheelDeltaX/6:0),o&&(a.preventDefault&&a.preventDefault(),a.returnValue=!1),s=parseInt(this._el.slider.style.left.replace("px",""))+o,r.left<s?s=r.left:s<r.right&&(s=r.right),this.animate_css&&(this._el.slider.className="tl-timenav-slider",this.animate_css=!1),this._el.slider.style.left=s+"px"},_onDragMove(){this.animate_css&&(this._el.slider.className="tl-timenav-slider",this.animate_css=!1)},_updateDisplay(a,t){a&&(this.options.width=a),t&&t!=this.options.height&&(this.options.height=t,this.timescale=this._getTimeScale()),this._assignRowsToMarkers(),this._el.slider_background.style.width=this.timescale.getPixelWidth()+this.options.width+"px",this._el.slider_background.style.left=-this.options.width/2+"px",this._el.slider.style.width=this.timescale.getPixelWidth()+this.options.width+"px",this._swipable.updateConstraint({top:!1,bottom:!1,left:this.options.width/2,right:-(this.timescale.getPixelWidth()-this.options.width/2)}),this.goToId(this.current_id,!0)},_drawTimeline(e){this.timescale=this._getTimeScale(),this.timeaxis.drawTicks(this.timescale,this.options.optimal_tick_width),this._positionMarkers(e),this._assignRowsToMarkers()},_updateDrawTimeline(a){var t=!1;if(a){var o=new TL.TimeScale(this.config,{display_width:this._el.container.offsetWidth,screen_multiplier:this.options.scale_factor,max_rows:this.max_rows});this.timescale.getMajorScale()==o.getMajorScale()&&this.timescale.getMinorScale()==o.getMinorScale()&&(t=!0)}else t=!0;return t?(this.timescale=this._getTimeScale(),this.timeaxis.positionTicks(this.timescale,this.options.optimal_tick_width),this._positionMarkers(),this._assignRowsToMarkers(),this._updateDisplay()):this._drawTimeline(!0),t},_initLayout(){this._el.slider=TL.Dom.create("div","tl-timenav-slider",this._el.container),this._el.slider_background=TL.Dom.create("div","tl-timenav-slider-background",this._el.slider),this._el.marker_container_mask=TL.Dom.create("div","tl-timenav-container-mask",this._el.slider),this._el.marker_container=TL.Dom.create("div","tl-timenav-container",this._el.marker_container_mask),this._el.marker_item_container=TL.Dom.create("div","tl-timenav-item-container",this._el.marker_container),this._el.timeaxis=TL.Dom.create("div","tl-timeaxis",this._el.slider),this._el.timeaxis_background=TL.Dom.create("div","tl-timeaxis-background",this._el.container),this.timeaxis=new TL.TimeAxis(this._el.timeaxis,this.options),this._swipable=new TL.Swipable(this._el.slider_background,this._el.slider,{enable:{x:!0,y:!1},constraint:{top:!1,bottom:!1,left:this.options.width/2,right:!1},snap:!1}),this._swipable.enable()},_initEvents(){this._swipable.on("dragmove",this._onDragMove,this),TL.DomEvent.addListener(this._el.container,"mousewheel",this._onMouseScroll,this),TL.DomEvent.addListener(this._el.container,"DOMMouseScroll",this._onMouseScroll,this)},_initData(){this._createMarkers(this.config.events),this._drawTimeline()}}),TL.TimeMarker=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize(a,t){this._el={container:{},content_container:{},media_container:{},timespan:{},line_left:{},line_right:{},content:{},text:{},media:{}},this._text={},this._state={loaded:!1},this.data={unique_id:"",background:null,date:{year:0,month:0,day:0,hour:0,minute:0,second:0,millisecond:0,thumbnail:"",format:""},text:{headline:"",text:""},media:null},this.options={duration:1e3,ease:TL.Ease.easeInSpline,width:600,height:600,marker_width_min:100},this.active=!1,this.animator={},this.has_end_date=!1,TL.Util.mergeData(this.options,t),TL.Util.mergeData(this.data,a),this._initLayout(),this._initEvents()},show(){},hide(){},setActive(e){this.active=e,this._el.container.className=this.active&&this.has_end_date?"tl-timemarker tl-timemarker-with-end tl-timemarker-active":this.active?"tl-timemarker tl-timemarker-active":this.has_end_date?"tl-timemarker tl-timemarker-with-end":"tl-timemarker"},addTo(e){e.appendChild(this._el.container)},removeFrom(e){e.removeChild(this._el.container)},updateDisplay(a,t){this._updateDisplay(a,t)},loadMedia(){this._media&&!this._state.loaded&&(this._media.loadMedia(),this._state.loaded=!0)},stopMedia(){this._media&&this._state.loaded&&this._media.stopMedia()},getLeft(){return this._el.container.style.left.slice(0,-2)},getTime(){return this.data.start_date.getTime()},getEndTime(){return!!this.data.end_date&&this.data.end_date.getTime()},setHeight(a){var t=1;this._el.content_container.style.height=a+"px",this._el.timespan_content.style.height=a+"px",this._el.content.className=30>=a?"tl-timemarker-content tl-timemarker-content-small":"tl-timemarker-content",56>=a?TL.DomUtil.addClass(this._el.content_container,"tl-timemarker-content-container-small"):TL.DomUtil.removeClass(this._el.content_container,"tl-timemarker-content-container-small"),TL.Browser.webkit?(1>(t=Math.floor(a/14))&&(t=1),this._text.className="tl-headline",this._text.style.webkitLineClamp=t):(t=a/12,this._text.className=1<t?"tl-headline tl-headline-fadeout":"tl-headline",this._text.style.height=12*t+"px")},setWidth(e){this.data.end_date&&(this._el.container.style.width=e+"px",e>this.options.marker_width_min?(this._el.content_container.style.width=e+"px",this._el.content_container.className="tl-timemarker-content-container tl-timemarker-content-container-long"):(this._el.content_container.style.width=this.options.marker_width_min+"px",this._el.content_container.className="tl-timemarker-content-container"))},setClass(e){this._el.container.className=e},setRowPosition(a,t){this.setPosition({top:a}),this._el.timespan.style.height=t+"px"},_onMarkerClick(){this.fire("markerclick",{unique_id:this.data.unique_id})},_initLayout(){if(this._el.container=TL.Dom.create("div","tl-timemarker"),this.data.unique_id&&(this._el.container.id=this.data.unique_id+"-marker"),this.data.end_date&&(this.has_end_date=!0,this._el.container.className="tl-timemarker tl-timemarker-with-end"),this._el.timespan=TL.Dom.create("div","tl-timemarker-timespan",this._el.container),this._el.timespan_content=TL.Dom.create("div","tl-timemarker-timespan-content",this._el.timespan),this._el.content_container=TL.Dom.create("div","tl-timemarker-content-container",this._el.container),this._el.content=TL.Dom.create("div","tl-timemarker-content",this._el.content_container),this._el.line_left=TL.Dom.create("div","tl-timemarker-line-left",this._el.timespan),this._el.line_right=TL.Dom.create("div","tl-timemarker-line-right",this._el.timespan),this.data.media){this._el.media_container=TL.Dom.create("div","tl-timemarker-media-container",this._el.content);var a={url:this.data.media.thumbnail},t=this.data.media.thumbnail?TL.MediaType(a,!0):null;if(t){var e=new t.cls(a);e.on("loaded",function(){this._el.media=TL.Dom.create("img","tl-timemarker-media",this._el.media_container),this._el.media.src=e.getImageURL()}.bind(this)),e.loadMedia()}else{var i=TL.MediaType(this.data.media).type;this._el.media=TL.Dom.create("span","tl-icon-"+i,this._el.media_container)}}this._el.text=TL.Dom.create("div","tl-timemarker-text",this._el.content),this._text=TL.Dom.create("h2","tl-headline",this._el.text),this.data.text.headline&&""!=this.data.text.headline?this._text.innerHTML=TL.Util.unlinkify(this.data.text.headline):this.data.text.text&&""!=this.data.text.text?this._text.innerHTML=TL.Util.unlinkify(this.data.text.text):this.data.media&&this.data.media.caption&&""!=this.data.media.caption&&(this._text.innerHTML=TL.Util.unlinkify(this.data.media.caption)),this.onLoaded()},_initEvents(){TL.DomEvent.addListener(this._el.container,"click",this._onMarkerClick,this)},_updateDisplay(a,t){a&&(this.options.width=a),t&&(this.options.height=t)}}),TL.TimeScale=TL.Class.extend({initialize(a,t){var o=a.events;this._scale=a.scale,t=TL.Util.mergeData({display_width:500,screen_multiplier:3,max_rows:null},t),this._display_width=t.display_width,this._screen_multiplier=t.screen_multiplier,this._pixel_width=this._screen_multiplier*this._display_width,this._group_labels=void 0,this._positions=[],this._pixels_per_milli=0,this._earliest=a.getEarliestDate().getTime(),this._latest=a.getLatestDate().getTime(),this._span_in_millis=this._latest-this._earliest,0>=this._span_in_millis&&(this._span_in_millis=this._computeDefaultSpan(a)),this._average=this._span_in_millis/o.length,this._pixels_per_milli=this.getPixelWidth()/this._span_in_millis,this._axis_helper=TL.AxisHelper.getBestHelper(this),this._scaled_padding=1/this.getPixelsPerTick()*(this._display_width/2),this._computePositionInfo(o,t.max_rows)},_computeDefaultSpan(o){if("human"!=o.scale)return 2e5;for(var t,s={},e=0;e<o.events.length;e++)t=o.events[e].start_date.findBestFormat(),s[t]=s[t]?s[t]+1:1;for(e=TL.Date.SCALES.length-1;0<=e;e--)if(s.hasOwnProperty(TL.Date.SCALES[e][0])){var r=TL.Date.SCALES[TL.Date.SCALES.length-1];return TL.Date.SCALES[e+1]&&(r=TL.Date.SCALES[e+1]),r[1]}return 31536e6},getGroupLabels(){return this._group_labels||[]},getScale(){return this._scale},getNumberOfRows(){return this._number_of_rows},getPixelWidth(){return this._pixel_width},getPosition(e){return(e-this._earliest)*this._pixels_per_milli},getPositionInfo(e){return this._positions[e]},getPixelsPerTick(){return this._axis_helper.getPixelsPerTick(this._pixels_per_milli)},getTicks(){return{major:this._axis_helper.getMajorTicks(this),minor:this._axis_helper.getMinorTicks(this)}},getDateFromTime(e){if("human"==this._scale)return new TL.Date(e);if("cosmological"==this._scale)return new TL.BigDate(new TL.BigYear(e));throw new TL.Error("time_scale_scale_err",this._scale)},getMajorScale(){return this._axis_helper.major.name},getMinorScale(){return this._axis_helper.minor.name},_computeRowInfo(d,t){for(var c=[],i=0,_=0;_<d.length;_++){var m=d[_],s=[];delete m.row;for(var o=0;o<c.length;o++)if(s.push(c[o].end-m.start),0>=s[o]){c[m.row=o]=m;break}if(void 0===m.row)if(null===t)m.row=c.length,c.push(m);else if(0<t)m.row=c.length,c.push(m),t--;else{var p=Math.min.apply(null,s),l=s.indexOf(p);m.row=l,m.end>c[l].end&&(c[l]=m),i++}}return{n_rows:c.length,n_overlaps:i}},_computePositionInfo(l,t,e){e=e||100;for(var d,c=[],_=0;_<l.length;_++){if(d={start:this.getPosition(l[_].start_date.getTime())},this._positions.push(d),void 0!==l[_].end_date){var m=this.getPosition(l[_].end_date.getTime());d.width=m-d.start,d.end=d.width>e?d.start+d.width:d.start+e}else d.width=e,d.end=d.start+e;l[_].group?0>c.indexOf(l[_].group)&&c.push(l[_].group):0}if(!c.length){var o=this._computeRowInfo(this._positions,t);this._number_of_rows=o.n_rows}}}),TL.TimeAxis=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize(a,t){this._el={container:{},content_container:{},major:{},minor:{}},this._text={},this._state={loaded:!1},this.data={},this.options={duration:1e3,ease:TL.Ease.easeInSpline,width:600,height:600},this.active=!1,this.animator={},this.axis_helper={},this.minor_ticks=[],this.major_ticks=[],this.dateformat_lookup={millisecond:"time_milliseconds",second:"time_short",minute:"time_no_seconds_short",hour:"time_no_minutes_short",day:"full_short",month:"month_short",year:"year",decade:"year",century:"year",millennium:"year",age:"compact",epoch:"compact",era:"compact",eon:"compact",eon2:"compact"},this._el.container="object"==typeof a?a:TL.Dom.get(a),TL.Util.mergeData(this.options,t),this._initLayout(),this._initEvents()},show(){},hide(){},addTo(e){e.appendChild(this._el.container)},removeFrom(e){e.removeChild(this._el.container)},updateDisplay(a,t){this._updateDisplay(a,t)},getLeft(){return this._el.container.style.left.slice(0,-2)},drawTicks(a,t){var e=a.getTicks();this._el.minor,this.dateformat_lookup[e.minor.name],e.minor.ticks,this.minor_ticks,this._el.major,this.dateformat_lookup[e.major.name],e.major.ticks,this.major_ticks,this._el.major.className="tl-timeaxis-major",this._el.minor.className="tl-timeaxis-minor",this._el.major.style.opacity=0,this._el.minor.style.opacity=0,this.major_ticks=this._createTickElements(e.major.ticks,this._el.major,this.dateformat_lookup[e.major.name]),this.minor_ticks=this._createTickElements(e.minor.ticks,this._el.minor,this.dateformat_lookup[e.minor.name],e.major.ticks),this.positionTicks(a,t,!0),this._el.major.className="tl-timeaxis-major tl-animate-opacity tl-timeaxis-animate-opacity",this._el.minor.className="tl-timeaxis-minor tl-animate-opacity tl-timeaxis-animate-opacity",this._el.major.style.opacity=1,this._el.minor.style.opacity=1},_createTickElements(d,t,e,i){t.innerHTML="";var c={};if(c[new Date(-1,13,-30).getTime()]=!0,i)for(var a=0;a<i.length;a++)c[i[a].getTime()]=!0;var _=[];for(a=0;a<d.length;a++){var o=d[a];if(!(o.getTime()in c)){var r=TL.Dom.create("div","tl-timeaxis-tick",t),l=TL.Dom.create("span","tl-timeaxis-tick-text tl-animate-opacity",r);l.innerHTML=o.getDisplayDate(this.getLanguage(),e),_.push({tick:r,tick_text:l,display_date:o.getDisplayDate(this.getLanguage(),e),date:o})}}return _},positionTicks(a,t,e){e?(this._el.major.className="tl-timeaxis-major",this._el.minor.className="tl-timeaxis-minor"):(this._el.major.className="tl-timeaxis-major tl-timeaxis-animate",this._el.minor.className="tl-timeaxis-minor tl-timeaxis-animate"),this._positionTickArray(this.major_ticks,a,t),this._positionTickArray(this.minor_ticks,a,t)},_positionTickArray(r,t,e){if(r[1]&&r[0]){var i=1;t.getPosition(r[1].date.getMillisecond())-t.getPosition(r[0].date.getMillisecond())<e&&(i=Math.round(e/t.getPixelsPerTick()));for(var l,d=1,c=0;c<r.length;c++)l=r[c],l.tick.style.left=t.getPosition(l.date.getMillisecond())+"px",l.tick_text.innerHTML=l.display_date,1<i?i<=d?(d=1,l.tick_text.style.opacity=1,l.tick.className="tl-timeaxis-tick"):(d++,l.tick_text.style.opacity=0,l.tick.className="tl-timeaxis-tick tl-timeaxis-tick-hidden"):(l.tick_text.style.opacity=1,l.tick.className="tl-timeaxis-tick")}},_initLayout(){this._el.content_container=TL.Dom.create("div","tl-timeaxis-content-container",this._el.container),this._el.major=TL.Dom.create("div","tl-timeaxis-major",this._el.content_container),this._el.minor=TL.Dom.create("div","tl-timeaxis-minor",this._el.content_container),this.onLoaded()},_initEvents(){},_updateDisplay(a,t){a&&(this.options.width=a),t&&(this.options.height=t)}}),TL.AxisHelper=TL.Class.extend({initialize(e){if(!e)throw new TL.Error("axis_helper_no_options_err");this.scale=e.scale,this.minor=e.minor,this.major=e.major},getPixelsPerTick(e){return e*this.minor.factor},getMajorTicks(e){return this._getTicks(e,this.major)},getMinorTicks(e){return this._getTicks(e,this.minor)},_getTicks(r,t){for(var e=r._scaled_padding*t.factor,i=r._earliest-e,l=r._latest+e,a=[],s=i;s<l;s+=t.factor)a.push(r.getDateFromTime(s).floor(t.name));return{name:t.name,ticks:a}}}),function(o){function e(s,t){d[s]=[];for(var e=0;e<t.length-1;e++){var r=t[e],l=t[e+1];d[s].push(new o({scale:r[3],minor:{name:r[0],factor:r[1]},major:{name:l[0],factor:l[1]}}))}}var d={};e("human",TL.Date.SCALES),e("cosmological",TL.BigDate.SCALES),o.HELPERS=d,o.getBestHelper=function(l,t){"number"!=typeof t&&(t=100);var c=l.getScale(),i=d[c];if(!i)throw new TL.Error("axis_helper_scale_err",c);for(var _=null,m=0;m<i.length;m++){var p=i[m],o=p.getPixelsPerTick(l._pixels_per_milli);if(t<o)return null==_||Math.abs(t-o)<Math.abs(t-o)?p:_;_=p}return i[i.length-1]}}(TL.AxisHelper),TL.Timeline=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],initialize(a,t,e){var o=this;if(e=e||{},this.version="3.2.6",this.ready=!1,this._el={container:{},storyslider:{},timenav:{},menubar:{}},this._el.container="object"==typeof a?a:TL.Dom.get(a),this._storyslider={},this._style_sheet=new TL.StyleSheet,this._timenav={},this._menubar={},this._loaded={storyslider:!1,timenav:!1},this.config=null,this.options={script_path:"",height:this._el.container.offsetHeight,width:this._el.container.offsetWidth,debug:!1,is_embed:!1,is_full_embed:!1,hash_bookmark:!1,default_bg_color:{r:255,g:255,b:255},scale_factor:2,layout:"landscape",timenav_position:"bottom",optimal_tick_width:60,base_class:"tl-timeline",timenav_height:null,timenav_height_percentage:25,timenav_mobile_height_percentage:40,timenav_height_min:175,marker_height_min:30,marker_width_min:100,marker_padding:5,start_at_slide:0,start_at_end:!1,menubar_height:0,skinny_size:650,medium_size:800,relative_date:!1,use_bc:!1,duration:1e3,ease:TL.Ease.easeInOutQuint,dragging:!0,trackResize:!0,map_type:"stamen:toner-lite",slide_padding_lr:100,slide_default_fade:"0%",zoom_sequence:[.5,1,2,3,5,8,13,21,34,55,89],language:"en",ga_property_id:null,track_events:["back_to_start","nav_next","nav_previous","zoom_in","zoom_out"]},this.animator_timenav=null,this.animator_storyslider=null,this.animator_menubar=null,this.message=new TL.Message({},{message_class:"tl-message-full"},this._el.container),"string"==typeof e.default_bg_color){var s=TL.Util.hexToRgb(e.default_bg_color);s?e.default_bg_color=s:(delete e.default_bg_color,trace("Invalid default background color. Ignoring."))}TL.Util.mergeData(this.options,e),window.addEventListener("resize",function(){o.updateDisplay()}),TL.debug=this.options.debug,TL.DomUtil.addClass(this._el.container,"tl-timeline"),this.options.is_embed&&TL.DomUtil.addClass(this._el.container,"tl-timeline-embed"),this.options.is_full_embed&&TL.DomUtil.addClass(this._el.container,"tl-timeline-full-embed"),document.addEventListener("keydown",function(s){var t=s.key,e=o._getSlideIndex(o.current_id),i=o.config.events.length-1,r=o.config.title?1+i:i;"ArrowLeft"==t?0!=e&&o.goToPrev():"ArrowRight"==t&&e!=r&&o.goToNext()}),this.options.relative_date?"undefined"==typeof moment?TL.Load.js(this.options.script_path+"/library/moment.js",function(){o._loadLanguage(t),trace("LOAD MOMENTJS")}):o._loadLanguage(t):o._loadLanguage(t)},_translateError(e){return e.hasOwnProperty("stack")&&trace(e.stack),e.message_key?this._(e.message_key)+(e.detail?" ["+e.detail+"]":""):e},_loadLanguage(e){try{this.options.language=new TL.Language(this.options),this._initData(e)}catch(e){this.showMessage(this._translateError(e))}},goToId(e){this.current_id!=e&&(this.current_id=e,this._timenav.goToId(this.current_id),this._storyslider.goToId(this.current_id,!1,!0),this.fire("change",{unique_id:this.current_id},this))},goTo(e){this.config.title?0==e?this.goToId(this.config.title.unique_id):this.goToId(this.config.events[e-1].unique_id):this.goToId(this.config.events[e].unique_id)},goToStart(){this.goTo(0)},goToEnd(){var e=this.config.events.length-1;this.goTo(this.config.title?1+e:e)},goToPrev(){this.goTo(this._getSlideIndex(this.current_id)-1)},goToNext(){this.goTo(this._getSlideIndex(this.current_id)+1)},add(a){var t=this.config.addEvent(a),e=this._getEventIndex(t),i=this.config.events[e];this._storyslider.createSlide(i,this.config.title?e+1:e),this._storyslider._updateDrawSlides(),this._timenav.createMarker(i,e),this._timenav._updateDrawTimeline(!1),this.fire("added",{unique_id:t})},remove(a){if(0<=a&&a<this.config.events.length){this.config.events[a].unique_id==this.current_id&&(a<this.config.events.length-1?this.goTo(a+1):this.goTo(a-1));var t=this.config.events.splice(a,1);delete this.config.event_dict[t[0].unique_id],this._storyslider.destroySlide(this.config.title?a+1:a),this._storyslider._updateDrawSlides(),this._timenav.destroyMarker(a),this._timenav._updateDrawTimeline(!1),this.fire("removed",{unique_id:t[0].unique_id})}},removeId(e){this.remove(this._getEventIndex(e))},getData(e){if(this.config.title){if(0==e)return this.config.title;if(0<e&&e<=this.config.events.length)return this.config.events[e-1]}else if(0<=e&&e<this.config.events.length)return this.config.events[e];return null},getDataById(e){return this.getData(this._getSlideIndex(e))},getSlide(e){return 0<=e&&e<this._storyslider._slides.length?this._storyslider._slides[e]:null},getSlideById(e){return this.getSlide(this._getSlideIndex(e))},getCurrentSlide(){return this.getSlideById(this.current_id)},updateDisplay(){this.ready&&this._updateDisplay()},_calculateTimeNavHeight(a,t){var e=0;return a?e=a:(this.options.timenav_height_percentage||t)&&(e=t?Math.round(this.options.height/100*t):Math.round(this.options.height/100*this.options.timenav_height_percentage)),this._timenav.ready&&this.options.timenav_height_min<this._timenav.getMinimumHeight()&&(this.options.timenav_height_min=this._timenav.getMinimumHeight()),e<this.options.timenav_height_min&&(e=this.options.timenav_height_min),e-2*this.options.marker_padding},_updateDisplay(o,t,e){var i,r=this.options.duration,l=this.options.base_class;e&&(r=e),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this.options.width<=this.options.skinny_size?(l+=" tl-skinny",this.options.layout="portrait"):(this.options.width<=this.options.medium_size&&(l+=" tl-medium"),this.options.layout="landscape"),TL.Browser.touch&&(this.options.layout=TL.Browser.orientation()),TL.Browser.mobile?(l+=" tl-mobile",this.options.timenav_height=this._calculateTimeNavHeight(o,this.options.timenav_mobile_height_percentage)):this.options.timenav_height=this._calculateTimeNavHeight(o),l+="portrait"==this.options.layout?" tl-layout-portrait":" tl-layout-landscape",this.options.storyslider_height=this.options.height-this.options.timenav_height,i="top"==this.options.timenav_position?Math.ceil(this.options.timenav_height)/2-this._el.menubar.offsetHeight/2-19.5:Math.round(this.options.storyslider_height+1+Math.ceil(this.options.timenav_height)/2-this._el.menubar.offsetHeight/2-17.5),t?(this._el.timenav.style.height=Math.ceil(this.options.timenav_height)+"px",this.animator_storyslider&&this.animator_storyslider.stop(),this.animator_storyslider=TL.Animate(this._el.storyslider,{height:this.options.storyslider_height+"px",duration:r/2,easing:TL.Ease.easeOutStrong}),this.animator_menubar&&this.animator_menubar.stop(),this.animator_menubar=TL.Animate(this._el.menubar,{top:i+"px",duration:r/2,easing:TL.Ease.easeOutStrong})):(this._el.timenav.style.height=Math.ceil(this.options.timenav_height)+"px",this._el.storyslider.style.height=this.options.storyslider_height+"px",this._el.menubar.style.top=i+"px"),this.message&&this.message.updateDisplay(this.options.width,this.options.height),this._timenav.updateDisplay(this.options.width,this.options.timenav_height,t),this._storyslider.updateDisplay(this.options.width,this.options.storyslider_height,t,this.options.layout),"rtl"==this.options.language.direction&&(l+=" tl-rtl"),this._el.container.className=l},_updateHashBookmark(a){var t="#event-"+a.toString();"file:"!=window.location.protocol&&window.history.replaceState(null,"Browsing TimelineJS",t),this.fire("hash_updated",{unique_id:this.current_id,hashbookmark:"#event-"+a.toString()},this)},_initData(a){var i=this;"string"==typeof a?(i=this,TL.ConfigFactory.makeConfig(a,function(e){i.setConfig(e)})):TL.TimelineConfig==a.constructor?this.setConfig(a):this.setConfig(new TL.TimelineConfig(a))},setConfig(a){if(this.config=a,this.config.validate(),this._validateOptions(),this.config.isValid())try{this._onDataLoaded()}catch(e){this.showMessage("<strong>"+this._("error")+":</strong> "+this._translateError(e))}else{for(var t=[],e=0,o=this.config.getErrors();e<o.length;e++)t.push(this._translateError(o[e]));this.showMessage("<strong>"+this._("error")+":</strong> "+t.join("<br>"))}},_validateOptions(){let a;for(var o=["timenav_height","timenav_height_min","marker_height_min","marker_width_min","marker_padding","start_at_slide","slide_padding_lr"],t=0;t<o.length;t++){var s=o[t],i=this.options[s];a=!0,"number"==typeof i?a=i==parseInt(i):"string"==typeof i&&(a=i.match(/^\s*(\-?\d+)?\s*$/)),a||this.config.logError({message_key:"invalid_integer_option",detail:s})}},_initLayout(){this.message.removeFrom(this._el.container),this._el.container.innerHTML="","top"==this.options.timenav_position?(this._el.timenav=TL.Dom.create("div","tl-timenav",this._el.container),this._el.storyslider=TL.Dom.create("div","tl-storyslider",this._el.container)):(this._el.storyslider=TL.Dom.create("div","tl-storyslider",this._el.container),this._el.timenav=TL.Dom.create("div","tl-timenav",this._el.container)),this._el.menubar=TL.Dom.create("div","tl-menubar",this._el.container),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this.options.timenav_height=this._calculateTimeNavHeight(this.options.timenav_height),this._timenav=new TL.TimeNav(this._el.timenav,this.config,this.options),this._timenav.on("loaded",this._onTimeNavLoaded,this),this._timenav.on("update_timenav_min",this._updateTimeNavHeightMin,this),this._timenav.options.height=this.options.timenav_height,this._timenav.init(),this.options.initial_zoom&&this.setZoom(this.options.initial_zoom),this._storyslider=new TL.StorySlider(this._el.storyslider,this.config,this.options),this._storyslider.on("loaded",this._onStorySliderLoaded,this),this._storyslider.init(),this._menubar=new TL.MenuBar(this._el.menubar,this._el.container,this.options),this.options.storyslider_height="portrait"==this.options.layout?this.options.height-this.options.timenav_height-1:this.options.height-1,this._updateDisplay(this._timenav.options.height,!0,2e3)},_initEvents(){this._timenav.on("change",this._onTimeNavChange,this),this._timenav.on("zoomtoggle",this._onZoomToggle,this),this._storyslider.on("change",this._onSlideChange,this),this._storyslider.on("colorchange",this._onColorChange,this),this._storyslider.on("nav_next",this._onStorySliderNext,this),this._storyslider.on("nav_previous",this._onStorySliderPrevious,this),this._menubar.on("zoom_in",this._onZoomIn,this),this._menubar.on("zoom_out",this._onZoomOut,this),this._menubar.on("back_to_start",this._onBackToStart,this)},_initGoogleAnalytics(){var a,o,s,r;a=window,o=document,a.GoogleAnalyticsObject="ga",a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=+new Date,s=o.createElement("script"),r=o.getElementsByTagName("script")[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(s,r),ga("create",this.options.ga_property_id,"auto"),ga("set","anonymizeIp",!0)},_initAnalytics(){if(null!==this.options.ga_property_id){this._initGoogleAnalytics(),ga("send","pageview");var a=this.options.track_events;for(let e=0;e<a.length;e++){var t=a[e];this.addEventListener(t,function(e){ga("send","event",e.type,"clicked")})}}},_onZoomToggle(e){"in"==e.zoom?this._menubar.toogleZoomIn(e.show):"out"==e.zoom&&this._menubar.toogleZoomOut(e.show)},_getEventIndex(a){for(var t=0;t<this.config.events.length;t++)if(a==this.config.events[t].unique_id)return t;return-1},_getSlideIndex(a){if(this.config.title&&this.config.title.unique_id==a)return 0;for(var t=0;t<this.config.events.length;t++)if(a==this.config.events[t].unique_id)return this.config.title?t+1:t;return-1},_onDataLoaded(){this.fire("dataloaded"),this._initLayout(),this._initEvents(),this._initAnalytics(),this.message&&this.message.hide(),this.ready=!0},showMessage(e){this.message?this.message.updateMessage(e):(trace("No message display available."),trace(e))},_onColorChange(e){this.fire("color_change",{unique_id:this.current_id},this),e.color||e.image},_onSlideChange(e){this.current_id!=e.unique_id&&(this.current_id=e.unique_id,this._timenav.goToId(this.current_id),this._onChange(e))},_onTimeNavChange(e){this.current_id!=e.unique_id&&(this.current_id=e.unique_id,this._storyslider.goToId(this.current_id),this._onChange(e))},_onChange(){this.fire("change",{unique_id:this.current_id},this),this.options.hash_bookmark&&this.current_id&&this._updateHashBookmark(this.current_id)},_onBackToStart(){this._storyslider.goTo(0),this.fire("back_to_start",{unique_id:this.current_id},this)},zoomIn(){this._timenav.zoomIn()},zoomOut(){this._timenav.zoomOut()},setZoom(e){this._timenav.setZoom(e)},_onZoomIn(){this._timenav.zoomIn(),this.fire("zoom_in",{zoom_level:this._timenav.options.scale_factor},this)},_onZoomOut(){this._timenav.zoomOut(),this.fire("zoom_out",{zoom_level:this._timenav.options.scale_factor},this)},_onTimeNavLoaded(){this._loaded.timenav=!0,this._onLoaded()},_onStorySliderLoaded(){this._loaded.storyslider=!0,this._onLoaded()},_onStorySliderNext(e){this.fire("nav_next",e)},_onStorySliderPrevious(e){this.fire("nav_previous",e)},_onLoaded(){this._loaded.storyslider&&this._loaded.timenav&&(this.fire("loaded",this.config),this.options.hash_bookmark&&""!=window.location.hash?this.goToId(window.location.hash.replace("#event-","")):(TL.Util.isTrue(this.options.start_at_end)||this.options.start_at_slide>this.config.events.length?this.goToEnd():this.goTo(this.options.start_at_slide),this.options.hash_bookmark&&this._updateHashBookmark(this.current_id)))}}),TL.Timeline.source_path=function(){var a=document.getElementsByTagName("script"),t=a[a.length-1].src;return t.substr(0,t.lastIndexOf("/"))}();