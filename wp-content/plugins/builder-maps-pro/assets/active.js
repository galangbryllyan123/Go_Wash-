((e,t,a,l,p,s,o,i)=>{"use strict";let _,n;e.ModuleMapsPro=class extends e.Module{constructor(e){let t=e.mod_settings||{};t.unit_w!==i&&t.w_map_unit===i&&(t.w_map_unit=t.unit_w),super(e)}static getOptions(){const e={...ThemifyConstructor.getOptions("orderBy")};return delete e.meta_value,[{id:"mod_title",type:"title"},{id:"map_display_type",type:"radio",label:"type",options:[{value:"dynamic",name:"dynamic"},{value:"static",name:"stimg"}],option_js:!0},{id:"w_map",type:"range",class:"xsmall",label:"w",units:{px:{max:3500},"%":""},default:100,wrap_class:"tb_group_element_dynamic"},{id:"w_map_static",type:"range",class:"xsmall",label:"w",wrap_class:"tb_group_element_static",units:{px:{max:3500}},default:500},{id:"h_map",type:"range",label:"ht",class:"xsmall",default:350,units:{px:{max:3500}}},{id:"type_map",type:"select",label:"type",options:{ROADMAP:"roadm",SATELLITE:"stlle",HYBRID:"hybrid",TERRAIN:"terrain"}},{id:"style_map",type:"map_pro_styles",label:"stl",setOptions:!1},{id:"draggable_map",type:"select",label:"dragle",options:{enable:"en",desktop_only:"mpp_en_dsk",disable:"dis"},wrap_class:"tb_group_element_dynamic"},{id:"map_link",type:"checkbox",label:"mpp_mapl",options:[{name:"gmaps",value:"mpp_op_gmap"}],wrap_class:"tb_group_element_static"},{id:"zoom_map",type:"select",label:"zoom",default:4,options:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20}},{id:"disable_map_ui",type:"toggle_switch",label:"mcotrols",wrap_class:"tb_group_element_dynamic"},{id:"scrollwheel_map",type:"toggle_switch",label:"scrlwhl",options:{on:{name:"enable",value:"en"},off:{name:"disable",value:"dis"}},wrap_class:"tb_group_element_dynamic"},{id:"map_polyline",type:"toggle_switch",label:"mpp_usepoly",options:"simple",binding:{yes:{show:"map_polyline_options"},no:{hide:"map_polyline_options"}},wrap_class:"tb_group_element_dynamic"},{type:"multi",label:"",options:[{id:"map_polyline_geodesic",type:"select",label:"mpp_geod",default:"yes",rchoose:!0},{id:"map_polyline_stroke",type:"number",label:"mpp_strokew",after:"px",default:2,control:{event:"change"}},{id:"map_polyline_color",type:"color",default:"#ff0000",label:"mpp_strokec"}],wrap_class:"tb_group_element_dynamic map_polyline_options"},{id:"map_center",type:"textarea",label:"mpp_bmapad",control:{event:"change"}},{id:"display",type:"select",label:"mpp_mapmrk",options:{text:"text",posts:"posts"},binding:{text:{show:["text","map_display_type"],hide:"posts"},posts:{show:"posts",hide:["text","map_display_type"]}}},{type:"group",wrap_class:"text",options:[{type:"map_pro",options:{id:"markers",type:"builder",options:[{id:"address",type:"textarea",label:"mpp_add_latlng",wrap_class:"tb_disable_dc",control:{event:"change"}},{id:"latlng",type:"textarea",class:"latlng",control:{event:"change"}},{id:"title",type:"textarea",label:"tt",wrap_class:"tb_disable_dc",control:{event:"change"}},{id:"image",type:"image",label:"icon",wrap_class:"tb_disable_dc"}],new_row:"mpp_add_mrk"},help:"mpp_txtmrkh"}]},{type:"group",wrap_class:"posts",options:[{label:"mpp_cftype",id:"custom_field_type",type:"select",options:{"":"mpp_wp",ptb:"mpp_tfptb",acf:"mpp_acfpro"},binding:{empty:{show:["custom_field"],hide:["ptb_map_field","acf_map_field"]},ptb:{show:["ptb_map_field"],hide:["custom_field","acf_map_field"]},acf:{show:["acf_map_field"],hide:["custom_field","ptb_map_field"]}}},{label:"mpp_add_cf",id:"custom_field",type:"autocomplete",dataset:"custom_fields",help:"mpp_add_cfh"},{label:"mpp_ptbmap",id:"ptb_map_field",type:"select",dataset:"ptb_map_fields",help:"mpp_ptbmaph"},{label:"mpp_acfmap",id:"acf_map_field",type:"select",dataset:"acf_map_fields"},{type:"query_posts",id:"post_type_post",tax_id:"tax",term_id:"tax_category",slug_id:"post_slug"},{id:"per_page",type:"number",label:"npost",help:"nposth"},{id:"order",type:"select",label:"order",help:"ohelp",order:!0},{id:"orderby",type:"select",label:"orderby",options:e},{id:"offset",type:"number",label:"ofs",help:"ofsh"},{id:"marker_icon",type:"image",label:"icon"}]},{id:"trigger",type:"select",label:"mpp_shmrk",options:{click:"click",hover:"h"}},{type:"custom_css_id",custom_css:"css_class"}]}static getGroup(){return["addon"]}static default(){return{w_map_unit:"%",style_map:"pale-dawn",markers:[{address:"",title:""}]}}static builderSave(e){let t={tbpdq:"off",w_map:"100",w_map_unit:"px",h_map:"350",trigger:"click",orderby:"date",order:"desc",tax:"category",post_type_post:"post",map_link:!1,term_type:"category",tax_category:"0|single",map_display_type:"dynamic",display:"text",zoom_map:"4",type_map:"ROADMAP",scrollwheel_map:"disable",draggable_map:"enable",disable_map_ui:"no",map_polyline:"no",map_polyline_geodesic:"yes",map_polyline_stroke:"2",map_polyline_color:"#ff0000_1",w_map_static:"500"},a=e.tbpdq||"off",l=e.map_display_type||"dynamic",p=e.display||"text",s=e.term_type||"category",o=["w_map","h_map","zoom_map","w_map_static","map_polyline_stroke"];for(let a in t)e[a]===t[a]&&delete e[a];for(let a=4;a>-1;--a)e[o[a]]?.toString()===t[o[a]]&&delete e[o[a]];if("text"===p||"static"===l){s=null;for(let t=["custom_field_type","custom_field","per_page","order","orderby","offset","marker_icon"],a=t.length-1;a>-1;--a)delete e[t[a]];if("static"===l)for(let t=["w_map","w_map_unit","draggable_map","zoom_map","disable_map_ui","scrollwheel_map","map_polyline"],a=t.length-1;a>-1;--a)delete e[t[a]]}else delete e.map_link,delete e.w_map_static,"text"!==p&&delete e.markers;if("yes"!==e.map_polyline&&(delete e.map_polyline_geodesic,delete e.map_polyline_stroke,delete e.map_polyline_color),e.markers){const t=e.markers;for(let e=t.length-1;e>-1;--e)t[e].address?.trim()||t.splice(e,1)}(e.tbpdq||null===s)&&(delete e.post_type_post,delete e.tax,delete e.term_type,s=null),"post_slug"!==s&&delete e.post_slug,"category"!==s&&(delete e.tax_category,delete e["tax_"+e.tax]),e.custom_field_type&&delete e.custom_field,"ptb"!==e.custom_field_type&&delete e.ptb_map_field,"acf"!==e.custom_field_type&&delete e.acf_map_field,"sameauthor"!==a&&delete e.tbpdq_sameauthor_match_post_type,"no"!==e.tbpdq_sameauthor_match_post_type&&delete e.tbpdq_sameauthor_post_types,"acf"!==a&&delete e.tbpdq_acf_field,"ptbSearch"!==a&&delete e.tbpdq_ptbsearch_form,super.builderSave(e)}preview(e){if("posts"===e.display)return this.previewReload(e),"";const t=p("","module module-maps-pro"),{markers:a=[],map_display_type:l="dynamic",type_map:s="ROADMAP",zoom_map:i="4",w_map:_=100,h_map:n=350}=e,r=t.dataset;if(e.css_class&&(t.className+=" "+e.css_class),r.zoom=i,r.type=s,r.address=e.map_center,r.style_map=e.style_map||"",r.scrollwheel="enable"===e.scrollwheel_map?"1":"",r.polyline="yes"===e.map_polyline?"1":"",r.geodesic="no"===e.map_polyline_geodesic?"1":"",r.polylinestroke=e.map_polyline_stroke||2,r.polylinecolor=e.map_polyline_color||"",r.draggable="disable",r.disable_map_ui="yes"===e.disable_map_ui?"1":"",r.trigger="hover"===e.trigger?"1":"",e.mod_title&&t.appendChild(this.constructor.getModuleTitle(e.mod_title,"mod_title")),"dynamic"===l){const l=p("","maps-pro-canvas-container"),s=p("","maps-pro-canvas"),o=p("template");s.style.width=_+(e.w_map_unit||"px"),s.style.height=n+"px",l.appendChild(s);for(let e=0;e<a.length;++e){let t=a[e];o.content.appendChild(p("",{"data-address":t.latlng||t.address||"","data-image":t.image||""},t.title||""))}t.append(l,o)}else{let l=new Image,p=e.w_map_static||500,_=e.map_center?"center="+e.map_center:"";_+="&zoom="+i+"&maptype="+s.toLowerCase(),_+="&size="+(""+p).replace(/[^0-9]/,"")+"x"+(""+n).replace(/[^0-9]/,"")+"&key="+o.key;for(let e=0;e<a.length;++e){let t=a[e];_+=t.image?"&markers=icon:"+encodeURI(t.image)+"%7C"+encodeURI(t.address):"&markers="+encodeURI(t.address)}l.src="//maps.googleapis.com/maps/api/staticmap?"+_,t.appendChild(l)}return t}};const r=async(e,a)=>{if(l.google?.maps?.importLibrary)n=null;else{if(!n){const a=new URLSearchParams;a.set("libraries",e),a.set("key",o.key||""),a.set("v","weekly"),a.set("callback","google.maps.__ib__"),l.google??={},google.maps??={},n=new s(((e,l)=>{google.maps.__ib__=e,t.loadJs("https://maps.googleapis.com/maps/api/js?"+a,null,!1).catch(l)}))}await n}return google.maps.importLibrary(e,a)},d=async()=>(_===i&&(_=await e.LocalFetch({action:"tb_get_maps_pro_styles"})),_);e.jsModuleLoaded().then((()=>{let l,o,i=new Set,_=new Map,n=async()=>{const t=e.LightBox.el,[{MapTypeId:a},{Geocoder:p}]=await s.all([r("maps"),r("geocoding")]),{results:i}=await(new p).geocode({address:t.querySelector("#map_center").value}),_=t.querySelector("#map_polyline_color"),n=_.parentNode.nextElementSibling,m={zoom:~~t.querySelector("#zoom_map").value,mapTypeId:a[t.querySelector("#type_map").value],disableDefaultUI:"yes"===t.querySelector("#disable_map_ui").value};l.setCenter(i[0].geometry.location),l.setOptions(m),d().then((e=>{l.setOptions({styles:e[t.querySelector("#style_map").value]})})),o?.setOptions({geodesic:"yes"===t.querySelector("#map_polyline_geodesic").value,strokeColor:_.value,strokeOpacity:n?.classList.contains("color_opacity")&&n.value||1,strokeWeight:t.querySelector("#map_polyline_stroke").value,visible:!!t.querySelector("#map_polyline input").checked})},m=async(a,p,s,n)=>{const d=await(async e=>{let t;if(e?.trim()){const a=_.get(e),{LatLng:l}=await r("core");if(a){const[e,p]=a.split(",");t=new l(parseFloat(e),parseFloat(p))}else{let a,p=e.match(/^([-+]?[1-8]?\d(\.\d+)?|90(\.0+)?),?\s*([-+]?180(\.0+)?|[-+]?((1[0-7]\d)|([1-9]?\d))(\.\d+)?)(,\d+z)?$/);if(Array.isArray(p))a=new l(p[1],p[4]);else{const{Geocoder:t}=await r("geocoding"),{results:l}=await(new t).geocode({address:e});a=l[0].geometry.location}_.set(e,a.lat()+","+a.lng()),t=a}}return t})(a);if(!d)throw"";const{Marker:m}=await r("marker"),c=new m({map:l,position:d,draggable:!0,icon:s});if(s||c.setIcon(),i.add(c),o?.getPath().push(d),""!==p.trim()){let e;c.addListener("click",(async function(){if(!e){const{InfoWindow:t}=await r("streetView");e=new t({content:'<div class="maps-pro-content">'+p+"</div>"})}e.open(this.getMap(),this)}))}return c.addListener("dragend",(async a=>{const l=a.latLng,p=e.LightBox.el.querySelector("#markers").tfClass("tb_repeatable_field")[n],s=p.querySelector(".address .tb_lb_option_child");p.querySelector("textarea.latlng").value=s.value=l.lat()+","+l.lng(),t.triggerEvent(s,"change")})),d.lat()+","+d.lng()},c=()=>{for(let e of i)e.setMap(null),e=null;i.clear()},y=()=>{c(),o?.setPath([]);const t=e.LightBox.el.querySelector("#markers").tfClass("tb_repeatable_field");for(let e=t.length-1;e>-1;--e)t[e].querySelector("textarea.latlng").value=t[e].querySelector(".address .tb_lb_option_child").value;(async()=>{for(let e=0;e<t.length;++e){let a=t[e];await new s((t=>{setTimeout((async()=>{const l=a.querySelector("textarea.latlng");try{l.value=await m(a.querySelector(".address .tb_lb_option_child").value,a.querySelector(".title .tb_lb_option_child").value,a.tfClass("tb_uploader_input")[0].value,e)}catch(e){l.value=""}t()}),100*~~(e/5+1))}))}})()};ThemifyConstructor.map_pro={render(a,i){const d=p("",{id:"map-canvas",class:"tf_w"}),m=p("",{id:"map-preview",class:"tf_w"});return d.attachShadow({mode:"open"}).appendChild(p("",{style:"width:100%;height:100%"})),m.append(d,i.create([a.options]),p("","tb_group_element_static",themifyBuilder.i18n.label[a.help]||a.help)),queueMicrotask((()=>{setTimeout((()=>{let a=e.LightBox.el,p=e=>{const t=e.target,a=t.id;"markers"===a||t.classList.contains("tb_lb_option_child")&&t.closest("#markers")?y():("change"!==e.type||["map_center","zoom_map","type_map","style_map","disable_map_ui","map_polyline_geodesic","map_polyline_stroke"].includes(a)||t.closest("#map_polyline"))&&n()},i=a.querySelector("#map_polyline_color");a.tfOn("change",p,{passive:!0}).querySelector("#markers").tfOn("duplicate delete sortable added",p),i.tfOn("themify_builder_color_picker_change",p,{passive:!0}),t.on("themify_builder_lightbox_close",(()=>{a.tfOff("change",p,{passive:!0}),i.tfOff("themify_builder_color_picker_change",p,{passive:!0}),l=o=a=i=p=null,c(),_.clear()}),!0),(async()=>{const[{Map:t,Polyline:a},{LatLng:p}]=await s.all([r("maps"),r("core"),r("geocoding"),r("marker")]);l=new t(e.LightBox.el.querySelector("#map-canvas").shadowRoot.firstChild,{center:new p(-34.397,150.644),gestureHandling:!0,zoomControl:!0,scaleControl:!0,mapTypeControl:!0}),o=new a({}),o.setMap(l),n(),y()})()}),10)})),m}},ThemifyConstructor.map_pro_styles={render(e,t){e.type="select";const l=t.select.render(e,t),s=l.querySelector("select"),o=s.parentNode,i=t.getStyleVal(e.id);return o.classList.add("tf_lazy"),d().then((e=>{const t=a.createDocumentFragment(),l=["",...Object.keys(e)];for(let e=0;e<l.length;++e){let a=p("option"),s=l[e],o=s.split("-");a.value=s;for(let e=0;e<o.length;++e)o[e]=o[e].charAt(0).toUpperCase()+o[e].slice(1);a.text=o.join(" "),i===s&&(a.selected=!0),t.appendChild(a)}s.appendChild(t)})).finally((()=>{o.classList.remove("tf_lazy")})),l}}})),t.on("themify_builder_ready",(()=>{t.requestIdleCallback((()=>{(e.isFrontend?l.top:l).Themify.loadCss(o.url+"assets/admin.css",null,o.v)}),800)}),!0,e.is_builder_ready)})(tb_app,Themify,document,window,tb_createElement,Promise,themifyBuilder.maps_pro_vars,void 0);