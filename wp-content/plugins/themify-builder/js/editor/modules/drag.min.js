(($,W,X,V,j)=>{"use strict";W.Drag=e=>{if(!0!==W.isGSPage){let D;e.tfOn("pointerdown",e=>{1!==e.which||W.isPreview||e.target.closest(".tb_dragger,.tb_disable_sorting,.tb_editor_on")?D=null:(D=e.target).classList.contains("tb_grid_drag")?(D=null,W.columnResize(e)):0===D.tagName.indexOf("TB-")&&(D=e.composedPath()[0]).closest(".tab")&&(D=null)},{passive:!0}).tfOn("dragstart",function(S){if(D&&S.target.nodeType!==Node.TEXT_NODE){let C=S.target.closest("[draggable]");if(!C||"desktop"!==W.activeBreakPoint&&C.classList.contains("active_module"))S.preventDefault(),D=null;else{let y=C.classList,L=y.contains("module_row"),e=L,w=!L&&y.contains("module_column");if(e&&!D.classList.contains("tb_move"))S.preventDefault(),D=null;else{L||w||(L=y.contains("page_break_module")||y.contains("predesigned_row")||y.contains("tb_item_row")),D=null,S.stopImmediatePropagation();let o,s,g=null,p=L?"row":w?"column_move":y.contains("tb_grid")?"column":"module",l=[p],m=j.body,_=0,u=0,f,n,t,a=null,b=null,r,i,h=[W.ToolBar.el.getRootNode().host,V.document.tfId("tb_fixed_bottom_scroll")],d=W.Builder.get().el,c=[V.document.body],v=j.createElement("div");const x=t=>{if(null===b&&a){b=!0;let e="tb_main_toolbar_root"===t||"wpadminbar"===t?"-":"+";e+="="+i*r+"px",a.stop().animate({scrollTop:e},{duration:10,complete(){!0===b&&(b=null,x(t))}})}},P=function(){t&&clearInterval(t),r=5,t=setInterval(()=>{r<51?r+=5:(clearInterval(t),t=null)},1200),(f=null)!==g&&(g.style.display="none");for(let e=d.querySelectorAll("[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos");x(this.id)},A=()=>{t&&clearInterval(t),b=t=null,a.stop()},F=e=>{if(t&&clearInterval(t),!0===e){for(let e=h.length-1;-1<e;--e)h[e].tfOff("dragenter",P,{passive:!0}).tfOff("dragleave",A,{passive:!0});L&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="100"]')}),h=b=t=r=a=i=null}else if(i=1,"visual"!==W.mode&&((a=(a=W.ToolBar.el.getRootNode().host.closest(".interface-interface-skeleton__content"))||j.tfClass("edit-post-layout__content")[0])?i/=2:a=null),a=null===a?"desktop"===W.activeBreakPoint?$("body,html"):$("body,html",V.document):$(a),L&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="50"]')}),0<i)for(let e=h.length-1;-1<e;--e)h[e].tfOn("dragenter",P,{passive:!0}).tfOn("dragleave",A,{passive:!0})},N=e=>{e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed="none",f&&f.removeAttribute("data-pos"),null!==g&&(g.style.display="none")},T=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),o&&(o.style.top=e.clientY-s+"px"),!e.target||null!==b||e.target===m||e.target===C||"module"===p&&e.target.classList.contains("module_row"))N(e);else if((null===g||e.target!==g&&!e.target.classList.contains("tb_sortable_placeholder"))&&(e.dataTransfer.effectAllowed="move",0===_||0===u||10<e.clientY-_||10<_-e.clientY||10<e.clientX-u||10<u-e.clientX||e.target!==f)){_=e.clientY,u=e.clientX;let t=e.target;const r=t.getBoundingClientRect();let s=.5<(_-r.top)/r.height?"bottom":"top";if(!0===w){let l,e=t.classList;if(e.contains("row_inner")||e.contains("row_inner"))t=(l=t).tfClass("module_column")[0],s=null;else{if(e.contains("tb_col_side"))s=e[1].replace("tb_col_side_",""),t=t.parentNode;else{if(!e.contains("module_column"))return;s=.5<(u-r.left)/r.width?"right":"left"}l=t.parentNode}let o=l.dataset.dragW,a=t.dataset.dragArea;if(!o||!a){const i=getComputedStyle(l);if(!o){const n=l.closest("[data-cid]");if(!n)return;const d=l.offsetWidth;let e=W.Registry.get(n.dataset.cid).getSizes("gutter"),t=(e=(e=e?ThemifyStyles.getGutterValue(e):"")||i.getPropertyValue("--colg")).replace(parseFloat(e).toString(),"")||"%";e=parseFloat(e),o=0===e?"none":"%"===t?parseFloat(parseFloat(d*e/100).toFixed(2)).toString():"em"===t?e*parseFloat(i.getPropertyValue("font-size")):e,l.dataset.dragW=o;for(let e=l.children,t=e.length-1;-1<t;--t)for(let l=e[t].children,a=l.length-1;-1<a;--a)if(l[a].classList.contains("tb_col_side")){l[a].style.marginLeft=l[a].style.marginRight="";let e=l[a].classList.contains("tb_col_side_right")?"50":"-50",t=(l[a].style.width="none"===o?"":o+"px",l[a].style.transform="none"===o?"translateX("+e+"%)":"",l[a].getBoundingClientRect().left);t<0?l[a].style.marginLeft="10px":t>=j.documentElement.clientWidth&&(l[a].style.marginRight="10px")}}if(!a){if(a=i.getPropertyValue("--area")){for(let t=(a=a.split('" "')).length-1;-1<t;--t){let e=a[t].replaceAll('"',"").split(" ");e=Array.from(new Set(e)),a[t]=e.join(" ")}a='"'+a.join('" "')+'"'}else a="1";l.dataset.dragArea=a}}if(null===s)return;if("1"!==a&&!t.classList.contains("tb_drag_side_column")&&!t.classList.contains("tb_drag_one_column")){const c=getComputedStyle(t).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim();a.includes(c+" ")||a.includes(" "+c)?t.classList.add("tb_drag_side_column"):t.classList.add("tb_drag_one_column")}t.classList.contains("tb_drag_one_column")&&(s=.5<(_-r.top)/r.height?"right":"left")}if(t!==h[0]&&t!==h[1]){if(!o&&!1===w){if(t.classList.contains("module_column")){if(!(t=t.tfClass("tb_holder")[0]))return void N(e)}else t.classList.contains("tb_dragger")&&(t=t.parentNode);if(t.classList.contains("tb_holder")&&0<t.childElementCount&&(t="top"===s&&t.firstChild!==C?t.firstChild:t.lastChild)===C)return void N(e)}if(f&&f!==t){if(!1===w){const l="top"===s?t.previousSibling:t.nextElementSibling;if(l===f){const a=l.dataset.pos;if("top"===s&&"bottom"===a||"bottom"===s&&"top"===a)return}}f.removeAttribute("data-pos")}t.dataset.pos!==s&&(t.dataset.pos=s,null!==g)&&(g.style.display="",t.classList.contains("tb_holder")?t.appendChild(g):"top"===s?t.before(g):t.after(g)),f=t}}},B=function(e){e.stopImmediatePropagation(),c.push(W.MainPanel.el),c.push(W.ToolBar.el.getRootNode().host);for(let e=c.length-1;-1<e;--e)c[e].classList.add("tb_start_animate","tb_drag_start","tb_drag_"+l[0]),l[1]&&c[e].classList.add(l[1]);if(W.SmallPanel.hide(),W.ActionBar.clear(),this.classList.add("tb_draggable_item"),!0===w){this.parentNode.classList.add("tb_column_drag_inner");const a=d.querySelectorAll(".row_inner,.subrow_inner");for(let e=a.length-1;-1<e;--e){let t=a[e].children,l=a[e].getBoundingClientRect().width-5;for(let e=t.length-1;-1<e;--e)t[e].offsetWidth+t[e].offsetLeft<l&&t[e].classList.add("tb_hide_drag_col_right")}}F(),o&&(o.style.top=e.clientY+"px")},O=e=>{e.stopImmediatePropagation()},I=e=>{e.target&&(e.preventDefault(),e.stopImmediatePropagation()),n=!0;let t=e.target||e;if(t.classList.contains("module_column")||t.classList.contains("tb_col_side"))t=w?t.closest(".module_column"):t.querySelector("[data-pos]");else if(w){t=null;for(let e=j.tfClass("tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_column_drag_inner")}else t.classList.contains("tb_dragger")&&(t=t.closest("[draggable]"));if(!(t=(t===g||t.classList.contains("tb_sortable_placeholder"))&&(t=(t=t.closest(".tb_active_builder"))&&t.querySelector("[data-pos]"))&&t.classList.contains("tb_sortable_placeholder")?t.closest(".tb_holder"):t)||"module"===p&&t.classList.contains("module_row"))C.classList.remove("tb_draggable_item");else{W.ActionBar.clear();const l=C.closest(".module_row"),a=null!==l,o=a?C:C.cloneNode(!0),s=t.dataset.pos,r=e=>{const t=e.closest(".module_row");t&&t.classList.toggle("tb_row_empty",void 0===t.tfClass("active_module")[0])};if(g&&g.remove(),W.undoManager.start("move"),C.classList.remove("tb_draggable_item"),a||(o.style.display="none"),t.classList.contains("tb_holder")?t.appendChild(o):w||("top"===s?t.before(o):t.after(o)),w||a){const i=w?W.Drop.column(o,t,s):Promise.resolve();i.then(()=>{X.trigger("tb_"+p+"_sort",[o]),W.Utils._onResize(!0),r(l),r(t),W.undoManager.end("move")})}else{let e=y.contains("tb_grid")?"grid":y.contains("page_break_module")?"pagebreak":"predesign",t=C.dataset.slug,l="grid"===e?"row":p;C.dataset.type&&(e=C.dataset.type,"row"===l)&&y.contains("library_item")&&(e="library"),W.Drop[l](o,e,t).then(()=>{X.trigger("tb_"+p+"_sort",[o]),r(o),"module"===l&&"part"!==e&&"module"!==e?W.undoManager.clear("move"):W.undoManager.end("move")}).catch(()=>{W.undoManager.clear("move")})}}};if(v.className="tb_sortable_helper tf_box tf_overflow",y.contains("active_subrow")&&l.push("tb_drag_subrow"),e){if(j.body.classList.add("tb_drag_row"),"visual"!==W.mode){o=v.cloneNode(),v.style.opacity=0;const k=C.getBoundingClientRect();o.style.width=k.width+"px",o.style.left=k.left+"px",j.body.appendChild(o),s=o.offsetHeight/2}}else if("module"===p||w)if(w||y.contains("active_subrow"))v.innerHTML=w?"Column":"Subrow";else{let e=C.dataset.slug||W.Registry.get(C.dataset.cid).get("mod_name");if(e&&themifyBuilder.modules[e]){const E=themifyBuilder.modules[e],M=E.icon,q=j.createElement("span");q.textContent=E.name,q.className="tf_vmiddle",M&&v.appendChild(W.Helper.getIcon("ti-"+M)),v.appendChild(q)}}else if("column"===p)v.className+=" "+C.className,v.innerHTML=C.innerHTML;else if("row"===p&&(y.contains("page_break_module")||y.contains("predesigned_row"))){const z=y.contains("page_break_module")?"page_break_title":"predesigned_title";v.textContent=C.tfClass(z)[0].textContent}w||!L&&"visual"===W.mode||((g=j.createElement("div")).className="tb_sortable_placeholder tf_rel tf_w");const R=v.querySelector(".add_module_btn");null!==R&&R.remove(),j.body.appendChild(v),S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("Text","id"),S.dataTransfer.setDragImage(v,v.offsetWidth/2+2,v.offsetHeight/2),C.tfOn("dragend",function(e){if(e.stopImmediatePropagation(),j.body.tfOff("dragover",T),d.tfOff(["dragenter","dragleave","pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],O,{passive:!0}).tfOff("drop",I,{once:!0}),this.tfOff("drag",B,{once:!0,passive:!0}),!n){const t=d.querySelector("[data-pos]");t&&I(t)}v.remove(),o&&o.remove(),g&&g.remove();for(let e=j.querySelectorAll("[data-drag-w],[data-drag-area],[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos"),e[t].removeAttribute("data-drag-w"),e[t].removeAttribute("data-drag-area");for(let e=j.querySelectorAll(".tb_hide_drag_col_right,.tb_drag_one_column,.tb_drag_side_column,.tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_hide_drag_col_right","tb_drag_one_column","tb_drag_side_column","tb_column_drag_inner");if(this.classList.remove("tb_draggable_item","tb_drag_one_column","tb_drag_side_column"),F(!0),"visual"!==W.mode)for(let e=j.tfClass("is-drop-target"),t=e.length-1;-1<t;--t)e[t].classList.remove("is-drop-target");for(let e=c.length-1;-1<e;--e)c[e].classList.remove("tb_start_animate","tb_drag_start","tb_drag_start_"+l[0],"tb_drag_"+l[0]),l[1]&&c[e].classList.remove(l[1]);g=n=D=C=y=f=v=o=s=m=d=u=_=l=p=w=c=null,W.ActionBar.clear()},{once:!0,passive:!0}),"visual"===W.mode&&c.push(m);for(let e=c.length-1;-1<e;--e)c[e].classList.add("tb_drag_start_"+l[0]),l[1]&&c[e].classList.add(l[1]);C.tfOn("drag",B,{once:!0,passive:!0}),j.body.tfOn("dragover",T),d.tfOn("dragenter dragleave",O,{passive:!0}).tfOn("drop",I,{once:!0}),X.isTouch||d.tfOn(["pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],O,{passive:!0})}}}else S.preventDefault(),D=null})}},W.columnResize=e=>{e.stopPropagation();const t=j.body.classList,l=e.target,o=[],s=[],r=l.parentNode,i=r.parentNode,a=getComputedStyle(i),E=i.childElementCount,M=i.offsetWidth,n=l.classList.contains("tb_drag_right")?"w":"e",d=j.createElement("div"),c=j.createElement("div"),g=getComputedStyle(r).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim(),p=g&&"auto"!==g&&"initial"!==g&&"none"!==g?getComputedStyle(i).getPropertyValue("--area").replace(/  +/g," ").trim().split('" "'):"",m=a.getPropertyValue("column-gap"),_=parseFloat(m)||0;let u=getComputedStyle(i).getPropertyValue("--col").replace(/\s\s+/g," ").trim(),f,b,h=!1,v=e.clientX,y=100,L=0,w=0,C=0;if(X.trigger("disableInline"),"none"===u)u="";else if(u.includes("repeat"))if(u.includes("auto-fit")||u.includes("auto-fill"))u="";else{let o="",s=u.replace(/\s\,\s|\s\,|\,\s/g,",").replace(/\s\(\s|\s\(|\(\s/g,"(").replaceAll(" )",")").trim().split(" ");for(let a=0,e=s.length;a<e;++a)if(s[a].includes("repeat")){let e=s[a].split("(")[1].replace(")","").split(","),t=parseInt(e[0]),l=e[1].trim();isNaN(t)&&(l="1fr",t=E),o+=" "+(" "+l).repeat(t)}else o+=" "+s[a];u=o.trim()}if(p){let a=0;for(let l=p.length-1;-1<l;--l)if(p[l].includes(g)){let t=p[l].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===g&&(o.push(e),a=l);if(0<o.length)break}if(0<o.length){const z=Math.min.apply(null,o)-1,D=Math.max.apply(null,o)+1,N=i.children,V="w"==n?D:z,T=p[a].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ")[V]?.trim();if(!T)return;for(let e=p.length-1;-1<e;--e)if(p[e].includes(T)){let t=p[e].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===T&&s.push(e);if(0<s.length)break}for(let e=N.length-1;-1<e;--e)if(r!==N[e]&&T===getComputedStyle(N[e]).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim()){f=N[e];break}}const F=p[0].trim().split(" ").length;if(u){const B=F-u.split(" ").length;0<B&&(u+=" 1fr".repeat(B))}else u="1fr ".repeat(F).trim()}else{if(f="w"==n?r.previousElementSibling||r.nextElementSibling:r.nextElementSibling||r.previousElementSibling,!u){const I=[],R=i.children;for(let e=0,t=R.length;e<t;++e)I.push(R[e].getBoundingClientRect().width);const k=Math.min.apply(null,I).toFixed(2).toString();for(let e=I.length-1;-1<e;--e)I[e]=k===I[e].toFixed(2).toString()?"1fr":(I[e]/k).toFixed(2).toString().replace("0.",".")+"fr";u=I.join(" ")}const O=X.convert(i.children);o.push(O.indexOf(r)),s.push(O.indexOf(f))}(u=u.split(" "))[o[0]]||(o[0]=o[0]%u.length),u[s[0]]||(s[0]=s[0]%u.length);const S=u.length;m?m.includes("px")?C=(S-1)*_:m.includes("em")&&(w=(S-1)*_):y-=(S-1)*_;for(let t=S-1;-1<t;--t){let e=u[t];e.includes("fr")?L+=parseFloat(e):e.includes("%")?y-=parseFloat(e):e.includes("em")?w+=parseFloat(e):e.includes("px")&&(C+=parseFloat(e))}0!==w&&(w=parseFloat(a.getPropertyValue("font-size"))*w);const x=o.length,P=s.length,q=parseFloat((parseFloat(M*y/100)-C-w)/L),A=(d.className=c.className="tb_grid_drag_tooltip",l.classList.add("tb_drag_grid_current"),r.classList.add("tb_element_clicked"),"w"==n?(d.className+=" tb_grid_drag_right_tooltip",c.className+=" tb_grid_drag_left_tooltip"):(d.className+=" tb_grid_drag_left_tooltip",c.className+=" tb_grid_drag_right_tooltip"),r.style.willChange="width",f&&(f.style.willChange="width"),e=>{e.stopImmediatePropagation(),b=requestAnimationFrame(()=>{!1===h&&(h=!0,W.ActionBar.clear(),W.undoManager.start("style"),l.append(d,c));let t=parseInt(e.clientX)-v;if(v=e.clientX,0!==t){"e"==n&&(t*=-1);let e=parseFloat(t/q);if(0!==e){e=parseFloat(e/(x+P));let t=parseFloat(u[o[0]])+e,l=parseFloat(u[s[0]])-e;if(.001<t&&.001<l){t=t.toFixed(3)+"fr",l=l.toFixed(3)+"fr";for(let e=x-1;-1<e;--e)u[o[e]]=t;for(let e=P-1;-1<e;--e)u[s[e]]=l;i.style.setProperty("--col",u.join(" ")),d.textContent=t+" / "+r.offsetWidth+"px",f&&(c.textContent=l+" / "+f.clientWidth+"px")}}}})});l.tfOn("lostpointercapture",function(e){e.stopImmediatePropagation(),this.tfOff("pointermove",A,{passive:!0}),b&&cancelAnimationFrame(b),requestAnimationFrame(()=>{if(d.remove(),c.remove(),W.ActionBar.clear(),r.classList.remove("tb_element_clicked"),this.classList.remove("tb_drag_grid_current"),t.remove("tb_start_animate","tb_drag_grid_start"),r.style.willChange="",f&&(f.style.willChange=""),h){const e=i.closest("[data-cid]");for(let e=u.length-1;-1<e;--e)u[e]=parseFloat(parseFloat(u[e]).toFixed(3).replace("0.",".")).toString()+"fr";W.Registry.get(e.dataset.cid).setCols({size:u.join(" ")}),i.style.setProperty("--col",""),W.Utils.setCompactMode([r,f]),X.trigger("tb_grid_changed",e),W.Utils._onResize(!0),W.undoManager.end("style")}h=b=f=null})},{once:!0,passive:!0}).tfOn("pointermove",A,{passive:!0}).setPointerCapture(e.pointerId),t.add("tb_start_animate","tb_drag_grid_start")}})(jQuery,tb_app,Themify,window.top,document);